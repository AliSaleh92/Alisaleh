<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Workspace - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css?family=Tajawal:500,700,900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {margin:0; padding:0; min-height:100vh; font-family:'Tajawal',sans-serif; background:#f8fafc;}
        .sidebar {position:fixed;right:0;top:0;width:75px;height:100vh;background:#23395b;z-index:100;display:flex;flex-direction:column;align-items:center;}
        .logo {margin:32px auto 28px auto;font-size:1.3em;font-weight:900;color:#fff;letter-spacing:.5px;}
        .menu-item {width:99%;padding:25px 0;margin:7px 0;border-radius:17px;display:flex;justify-content:center;align-items:center;cursor:pointer;color:#cad6e8;font-size:1.45em;transition:.13s;}
        .menu-item.active, .menu-item:hover{background:#132443;color:#fff;}
        .main-content {margin-right:80px;padding:40px 7vw 70px 7vw;max-width:1100px;}
        .section {display:none;}
        .section.active{display:block;}
        .header {font-size:2.05em; font-weight:900; color:#23395b;margin-bottom:33px;letter-spacing:.5px;}
        .flat-card {background:#fff;border-radius:22px;box-shadow:0 2px 24px #23395b0f;}
        .stat-row {display:flex;gap:2.5vw;}
        .stat-card {flex:1; background:#fff; border-radius:22px; box-shadow:0 2px 24px #23395b0f; padding:32px 0; text-align:center; min-width:155px;}
        .stat-title{font-size:1.09em;color:#8590a2;}
        .stat-val {font-size:2.6em;color:#23395b;font-weight:900;}
        /* Ù…Ø´Ø±ÙˆØ¹ */
        .proj-list{display:flex;flex-wrap:wrap;gap:23px;}
        .proj-card{position:relative;background:#fff;border-radius:19px;box-shadow:0 2px 16px #23395b13;padding:30px 34px 22px 20px;flex:1 1 290px; min-width:230px;}
        .proj-label{position:absolute;top:-19px;left:22px;font-size:.93em; background:var(--projcolor,#23395b);color:#fff;padding:5px 18px;border-radius:17px;font-weight:700;}
        .proj-title{font-weight:800;font-size:1.14em;color:#243b5e;margin-bottom:3px;}
        .proj-info{color:#6d7790;font-size:.98em;margin-bottom:8px;}
        .proj-actions{margin-top:7px;}
        .btn{background:#23395b;padding:0 22px;height:34px;border-radius:11px;border:none;color:#fff;cursor:pointer;font-weight:700;letter-spacing:.1px;margin-left:7px;}
        .btn.sec{background:#eaeef3;color:#23395b;}
        /* Ø¯ÙØªØ± ØªØªØ¨Ø¹ Ø£ÙÙƒØ§Ø± */
        .tracker-panel{margin-top:18px;padding:18px;background:#fafbff;border-radius:12px;box-shadow:0 1px 8px #23395b09;}
        .tracker-title{font-weight:700;color:#19294b;margin-bottom:8px;}
        .tracker-input{display:flex;gap:7px;}
        .tracker-input input{padding:8px;font-size:1.01em;border-radius:9px;border:1.1px solid #23395b31;flex:1;}
        .tracker-table{width:100%;margin-top:11px;}
        .tracker-table th, .tracker-table td{padding:9px 6px;text-align:center;}
        .tracker-table th{background:#23395b;color:#fff;border-radius:7px;}
        .tracker-table tr:not(:last-child) td{border-bottom:1px solid #e2e5f1;}
        /* Ù…Ù‡Ø§Ù… */
        .task-list{display:flex;flex-direction:column;gap:23px;}
        .task-card{background:#fff; border-radius:19px; box-shadow:0 2px 16px #23395b10; padding:25px 27px 12px 20px;}
        .task-head{display:flex;align-items:center;justify-content:space-between}
        .task-proj-label{background:#23395b;color:#fff;border-radius:9px;padding:4px 13px;font-size:.98em;}
        .task-title{font-weight:800;font-size:1.14em;margin:5px 0 2px 0;}
        .task-desc{color:#6d7690;margin-bottom:8px;}
        .task-meta{font-size:.97em;color:#aab;}
        .note-li{background:#f4f5f7;border-radius:11px;padding:5px 11px;margin:2px 0 4px 0;color:#625b69;font-size:.98em;}
        .note-li small{color:#caa;margin-left:12px;}
        /* Modal */
        .modal-bg {position:fixed;top:0;right:0;left:0;bottom:0;background:rgba(70,40,90,.09);z-index:999;}
        .modal-box {position:fixed;top:50%;right:50%;transform:translate(50%,-50%);background:#fff;padding:18px 15px 18px 15px;border-radius:15px;box-shadow:0 12px 22px #23395b14;z-index:1000;width:320px;max-width:98vw;}
        .modal-box label {font-weight:700;margin:7px 0 0 0;display:inline-block;}
        .modal-box input, .modal-box textarea, .modal-box select {font-size:1em;padding:7px 6px;margin:6px 0 11px 0;border-radius:8px;border:1.2px solid #e8eaf1;width:96.5%;}
        .modal-btn-bar{display:flex;justify-content:right;gap:8px;margin-top:10px;}
        .add-fab {position:fixed;bottom:28px;left:6vw;width:53px;height:53px;background:#23395b;color:#fff;display:flex;align-items:center;justify-content:center;font-size:2em;
            border:none;border-radius:50%;box-shadow:0 6px 22px #23395b44;cursor:pointer;z-index:700;}
        .add-fab:hover {box-shadow:0 14px 42px #23395b77;}
        /* Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
        .note-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:17px;}
        .note-card{background:#fff;border-radius:16px;box-shadow:0 2px 8px #23395b17;padding:16px;}
        .note-title{font-weight:800;margin-bottom:6px;color:#23395b;}
        .empty-txt{text-align:center;color:#b9b1da;font-size:1.11em;padding:4px;}
        /* ØªÙ‚ÙˆÙŠÙ… */
        .cal-wrap{background:#fff;border-radius:22px;box-shadow:0 2px 16px #23395b10;padding:22px;margin-bottom:25px;}
        .calendar-grid {display: grid;grid-template-columns: repeat(7,1fr);gap:9px;}
        .calendar-cell {background:#f9fafd;border-radius:9px;text-align:center;padding:12px 0;color:#23395b;box-shadow:0 1px 3px #23395b11;}
        .calendar-cell.today {background:#23395b;color:#fff; font-weight:700;}
        @media (max-width:900px){
            .main-content{padding:20px 2vw 60px 2vw;}
            .proj-list,.task-list{gap:11px;}
        }
        @media (max-width:650px){
            .main-content{margin:0!important;padding:9px 0 45px 0;}
            .sidebar{top:auto;bottom:0;right:0;left:0;width:100vw;height:65px;flex-direction:row;gap:15px;}
            .logo{display:none;}
            .menu-item{padding:10px 0;margin:0;border-radius:12px;font-size:1.06em;}
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">AliW</div>
        <div class="menu-item active" onclick="showSection('dashboard')">ğŸ“Š</div>
        <div class="menu-item" onclick="showSection('projects')">ğŸ“</div>
        <div class="menu-item" onclick="showSection('tasks')">âœ…</div>
        <div class="menu-item" onclick="showSection('calendar')">ğŸ“…</div>
        <div class="menu-item" onclick="showSection('notes')">ğŸ“</div>
    </div>
    <div class="main-content">
        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <div class="header">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</div>
            <div class="stat-row">
                <div class="stat-card"><div class="stat-title">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="stat-val" id="statProjects">0</div></div>
                <div class="stat-card"><div class="stat-title">Ø§Ù„Ù…Ù‡Ø§Ù…</div><div class="stat-val" id="statTasks">0</div></div>
                <div class="stat-card"><div class="stat-title">Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="stat-val" id="statDone">0</div></div>
            </div>
        </div>
        <!-- Projects -->
        <div id="projects" class="section">
            <div class="header">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            <div style="margin-bottom:19px;"><button class="btn" onclick="openProjectModal()">+ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button></div>
            <div class="proj-list" id="projList"></div>
        </div>
        <!-- Tasks -->
        <div id="tasks" class="section">
            <div class="header">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            <div style="margin-bottom:19px;"><button class="btn" onclick="openTaskModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button></div>
            <div class="task-list" id="taskList"></div>
        </div>
        <!-- Calendar -->
        <div id="calendar" class="section">
            <div class="header">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
            <div class="cal-wrap">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;">
                  <button class="btn sec" onclick="moveMonth(-1)">âŸ¨</button>
                  <span id="calendarMonthYear"></span>
                  <button class="btn sec" onclick="moveMonth(1)">âŸ©</button>
                </div>
                <div class="calendar-grid" id="calendarDays"></div>
                <div style="margin-top:14px"><ul id="calendarDayTasks"></ul></div>
            </div>
        </div>
        <!-- Notes -->
        <div id="notes" class="section">
            <div class="header">Ø¯ÙØªØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
            <div style="margin-bottom:19px;"><button class="btn" onclick="openNoteModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</button></div>
            <div class="note-grid" id="noteGrid"></div>
        </div>
    </div>
    <button class="add-fab" id="addFab" title="Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯">ï¼‹</button>
    <script>
    let projects = JSON.parse(localStorage.getItem("aw_projects")||"[]");
    let tasks = JSON.parse(localStorage.getItem("aw_tasks")||"[]");
    let notes = JSON.parse(localStorage.getItem("aw_notes")||"[]");
    let selectedProj = projects.length ? projects[0].id : null;
    let trackers = {};

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    function showSection(sec){
        document.querySelectorAll('.menu-item').forEach((e,i)=>{
            e.classList.toggle('active',["dashboard","projects","tasks","calendar","notes"].indexOf(sec)===i)
        });
        document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
        document.getElementById(sec).classList.add('active');
        if(sec==="dashboard")renderDashboard();
        if(sec==="projects")renderProjects();
        if(sec==="tasks")renderTasks();
        if(sec==="calendar")renderCalendar();
        if(sec==="notes")renderNotes();
        document.getElementById('addFab').style.display=(sec==="notes"||sec==="tasks"||sec==="projects")?"block":"none";
    }
    // Dashboard
    function renderDashboard(){
      document.getElementById("statProjects").textContent=projects.length;
      document.getElementById("statTasks").textContent=tasks.length;
      document.getElementById("statDone").textContent=tasks.filter(t=>t.done).length;
    }
    // Projects & Modal & Ø£ÙÙƒØ§Ø±
    function renderProjects(){
        let grid=document.getElementById("projList");
        if(!projects.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹.</p>";return;}
        grid.innerHTML=projects.map(p=>{
          let projColor = p.color||"#23395b";
          let tracker = getTrackerIdeas(p.id);
          return `
        <div class="proj-card" style="--projcolor:${projColor}">
          <div class="proj-label">${p.name}</div>
          <div class="proj-title">${p.name}</div>
          <div class="proj-info">${p.desc||""}&nbsp;</div>
          <div style="margin-bottom:5px;font-size:.97em;color:${projColor}">${tasks.filter(t=>t.projectId==p.id).length} Ù…Ù‡Ø§Ù…</div>
          <div class="proj-actions">
              <button class="btn sec" onclick="editProjectPrompt(${p.id})">ØªØ­Ø±ÙŠØ±</button>
              <button class="btn" style="background:#e33a4a;" onclick="delProject(${p.id})">Ø­Ø°Ù</button>
          </div>
          <div class="tracker-panel">
              <div class="tracker-title">Ø¯ÙØªØ± ØªØªØ¨Ø¹ Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</div>
              <div class="tracker-input">
                  <input id="ideaInp-${p.id}" placeholder="Ø£Ø¯Ø®Ù„ ÙÙƒØ±Ø©/Ù…Ù‡Ù…Ø©"/>
                  <button class="btn" onclick="addTrackerIdea(${p.id})" style="padding:0 13px;height:37px;">Ø¥Ø¶Ø§ÙØ©</button>
              </div>
              <table class="tracker-table">
                  <tr><th>Ø§Ù„ÙÙƒØ±Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th></tr>
                  ${tracker.map(i=>`<tr><td>${i.text}</td><td>${i.date}</td></tr>`).join("")}
                </table>
                ${tracker.length==0?'<div class="empty-txt">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>':''}
          </div>
        </div>`;
        }).join("");
    }
    function getTrackerIdeas(pid){return JSON.parse(localStorage.getItem('tracker_'+pid)||"[]");}
    function setTrackerIdeas(pid,arr){localStorage.setItem('tracker_'+pid,JSON.stringify(arr));}
    function addTrackerIdea(pid){
        let inp=document.getElementById("ideaInp-"+pid);
        let txt=inp.value.trim();
        if(!txt)return;
        let arr=getTrackerIdeas(pid);
        arr.push({text:txt,date:new Date().toLocaleString('ar-SA',{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})});
        setTrackerIdeas(pid,arr);
        inp.value=""; renderProjects();
    }

    // Projects Modals
    function openProjectModal(proj){
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.09em;font-weight:800;margin-bottom:11px">${proj?'ØªØ¹Ø¯ÙŠÙ„':'Ø¥Ø¶Ø§ÙØ©'} Ù…Ø´Ø±ÙˆØ¹</div>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label> <input id="pName" value="${proj?.name||''}" maxlength="28"/>
            <label>Ø§Ù„ÙˆØµÙ</label> <input id="pDesc" value="${proj?.desc||''}"/>
            <label>Ù„ÙˆÙ† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label> <input id="pColor" value="${proj?.color||'#23395b'}" type="color" style="width:70px"/>
            <div class="modal-btn-bar">
              <button onclick="${proj?'saveProjEdit('+proj.id+')':'saveProjAdd()'}" class="btn">Ø­ÙØ¸</button>
              <button onclick="closeModal()" class="btn sec">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.body.append(bg,modal); window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function saveProjAdd(){
        let name=document.getElementById("pName").value.trim();
        if(!name)return alert("Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ");
        let desc=document.getElementById("pDesc").value.trim();
        let color=document.getElementById("pColor").value;
        let id=Date.now();
        projects.push({id,name,desc,color});
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        renderProjects();renderDashboard();
        closeModal();
    }
    function editProjectPrompt(id){openProjectModal(projects.find(p=>p.id==id));}
    function saveProjEdit(id){
        let name=document.getElementById("pName").value.trim();
        if(!name)return alert("Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ");
        let desc=document.getElementById("pDesc").value.trim();
        let color=document.getElementById("pColor").value;
        let i=projects.findIndex(p=>p.id==id);
        projects[i]={...projects[i],name,desc,color};
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        renderProjects();renderDashboard();closeModal();
    }
    function delProject(id){
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ"))return;
        projects=projects.filter(p=>p.id!=id);
        tasks=tasks.filter(t=>t.projectId!=id);
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        localStorage.removeItem('tracker_'+id);
        renderProjects();renderTasks();renderDashboard();
    }

    // Tasks & Modal
    function renderTasks(){
      let grid=document.getElementById("taskList");
      if(!tasks.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù….</p>";return;}
      grid.innerHTML=tasks.map(t=>{
        let proj=projects.find(p=>p.id==t.projectId);
        return `<div class="task-card">
            <div class="task-head">
                <span class="task-proj-label" style="background:${proj?.color||'#23395b'}">${proj?.name||""}</span>
                <span>
                   <button class="btn sec" onclick="toggleTask(${t.id})">${t.done?'â':'âœ”ï¸'}</button>
                   <button class="btn sec" onclick="editTaskModal(${t.id})">ØªØ­Ø±ÙŠØ±</button>
                   <button class="btn" style="background:#e33a4a;" onclick="delTask(${t.id})">Ø­Ø°Ù</button>
                </span>
            </div>
            <div class="task-title">${t.name}</div>
            <div class="task-desc">${t.desc||""}</div>
            <div class="task-meta">${t.date?`ğŸ“… ${t.date}`:""} ${t.repeat&&t.repeat!='Ø¨Ø¯ÙˆÙ†'?`| âŸ³ ${t.repeat}`:''}
            ${t.attach?`| <a href="${t.attach}" style="color:#23395b;text-decoration:underline;" target="_blank">Ø§Ù„Ù…Ø±ÙÙ‚</a>`:""}</div>
            <ul style="margin:6px 0 0 0;padding:0;list-style:none;">
              ${(t.notes||[]).map(n=>`<li class="note-li">${n.text}<small>${n.date}</small></li>`).join("")}
            </ul>
        </div>`;
      }).join("");
    }
    // Task Modal
    let tempNotes=[];
    function openTaskModal(task){
        tempNotes=task?.notes?task.notes.slice():[];
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.12em;font-weight:800;margin-bottom:10px">${task?"ØªØ­Ø±ÙŠØ± Ù…Ù‡Ù…Ø©":"Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©"}</div>
            <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <select id="taskProj">${projects.map(p=>`<option value="${p.id}" ${task?.projectId==p.id?'selected':''} style="background:${p.color}">${p.name}</option>`)}</select>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label><input id="taskName" maxlength="38" value="${task?.name||""}"/>
            <label>ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label><textarea id="taskDesc" rows="2">${task?.desc||""}</textarea>
            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input id="taskDate" type="date" value="${task?.date||""}"/>
            <label>Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
            <select id="taskRepeat">
                <option${!task?.repeat||task.repeat=="Ø¨Ø¯ÙˆÙ†"?" selected":""}>Ø¨Ø¯ÙˆÙ†</option>
                <option${task?.repeat=="ÙŠÙˆÙ…ÙŠ"?" selected":""}>ÙŠÙˆÙ…ÙŠ</option>
                <option${task?.repeat=="Ø£Ø³Ø¨ÙˆØ¹ÙŠ"?" selected":""}>Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                <option${task?.repeat=="Ø´Ù‡Ø±ÙŠ"?" selected":""}>Ø´Ù‡Ø±ÙŠ</option>
            </select>
            <label>Ù…Ø±ÙÙ‚/Ø±Ø§Ø¨Ø·</label><input id="taskAttach" type="text" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø£Ùˆ ÙˆØµÙ Ù…Ø®ØªØµØ±" value="${task?.attach||""}" />
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ù…Ù‡Ù…Ø© (Ø§Ø¶ØºØ· Enter Ù„Ù„ØªØ³Ø¬ÙŠÙ„)</label>
            <textarea id="taskNoteInput" rows="1" onkeyup="if(event.key=='Enter'){addTaskNote();}"></textarea>
            <ul id="taskNotesList" style="margin:0;list-style:none;padding:0;">
              ${(tempNotes||[]).map(n=>`<li class="note-li">${n.text}<small>${n.date}</small></li>`).join("")}
            </ul>
            <div class="modal-btn-bar">
              <button onclick="${task?'saveTaskEdit('+task.id+')':'saveTaskAdd()'}" class="btn">${task?"Ø­ÙØ¸":"Ø¥Ø¶Ø§ÙØ©"}</button>
              <button onclick="closeModal()" class="btn sec">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.body.append(bg,modal);window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function addTaskNote(){
        let txt=document.getElementById('taskNoteInput').value.trim();
        if(!txt)return;
        let d=new Date();
        let now=d.toLocaleString('ar-SA',{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});
        tempNotes.push({text:txt,date:now});
        renderTaskNotes();
        document.getElementById('taskNoteInput').value="";
    }
    function renderTaskNotes(){
        let lst=document.getElementById('taskNotesList');
        lst.innerHTML=(tempNotes||[]).map(n=>`<li class="note-li">
          <span>${n.text}</span>
          <small>${n.date}</small>
        </li>`).join('');
    }
    function saveTaskAdd(){
        let pId = +document.getElementById("taskProj").value;
        let name = document.getElementById("taskName").value.trim();
        let desc = document.getElementById("taskDesc").value.trim();
        let date = document.getElementById("taskDate").value;
        let repeat = document.getElementById("taskRepeat").value;
        let attach = document.getElementById("taskAttach").value.trim();
        if(!name)return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©");
        let id=Date.now();
        let notes=tempNotes.slice();
        tasks.push({id,projectId:pId,name,desc,date,repeat,attach,notes,done:false});
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        tempNotes=[];
        renderTasks();renderDashboard();
        closeModal();
    }
    function editTaskModal(id){openTaskModal(tasks.find(t=>t.id==id));}
    function saveTaskEdit(id){
        let pId = +document.getElementById("taskProj").value;
        let name = document.getElementById("taskName").value.trim();
        let desc = document.getElementById("taskDesc").value.trim();
        let date = document.getElementById("taskDate").value;
        let repeat = document.getElementById("taskRepeat").value;
        let attach = document.getElementById("taskAttach").value.trim();
        let i=tasks.findIndex(t=>t.id==id);
        let notes=tempNotes.slice();
        tasks[i]={...tasks[i],projectId:pId,name,desc,date,repeat,attach,notes};
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        tempNotes=[];
        renderTasks();renderDashboard();
        closeModal();
    }
    function delTask(id){
        if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
        tasks=tasks.filter(t=>t.id!=id);localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        renderTasks(); renderDashboard();
    }
    function toggleTask(id){
        let t=tasks.find(t=>t.id==id);t.done=!t.done;localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        renderTasks(); renderDashboard();
    }
    // Calendar
    let calDate=new Date();
    function moveMonth(val){calDate.setMonth(calDate.getMonth()+val);renderCalendar();}
    function renderCalendar(){
        let d=new Date(calDate);d.setDate(1);let month=d.getMonth(),year=d.getFullYear();
        document.getElementById("calendarMonthYear").textContent = `${year} - ${month+1}`;
        let days=[];for(let i=0;i<d.getDay();i++)days.push("");
        let lastDay=new Date(year,month+1,0).getDate();
        for(let i=1;i<=lastDay;i++)days.push(i);
        let today=new Date();let tDay=today.getDate(),tMonth=today.getMonth(),tYear=today.getFullYear();
        let html="";
        days.forEach(val=>{
            let isToday=val==tDay&&month==tMonth&&year==tYear;
            html+=`<div class="calendar-cell${isToday?' today':''}">${val}</div>`
        });
        document.getElementById("calendarDays").innerHTML=html;
        document.getElementById("calendarDayTasks").innerHTML="";
    }

    // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    function renderNotes(){
      let grid=document.getElementById("noteGrid");
      if(!notes.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</p>";return;}
      grid.innerHTML=notes.map(n=>`
        <div class="note-card">
          <div class="note-title">${n.title}</div>
          <div style="color:#555;font-size:1em;">${n.text}</div>
          <div style="font-size:0.91em;color:#bbb;margin-top:5px">ØªØ§Ø±ÙŠØ®: ${n.date}</div>
          <button class="btn sec" style="margin-top:8px" onclick="delNote(${n.id})">Ø­Ø°Ù</button>
        </div>
      `).join("");
    }
    function openNoteModal(){
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.09em;font-weight:800;margin-bottom:11px">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</div>
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label><input id="noteTitle"/><br>
            <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label><textarea id="noteText" rows="2"></textarea>
            <div class="modal-btn-bar">
            <button onclick="saveNoteAdd()" class="btn">Ø¥Ø¶Ø§ÙØ©</button>
            <button onclick="closeModal()" class="btn sec">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.body.append(bg,modal);window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function saveNoteAdd(){
        let title=document.getElementById("noteTitle").value.trim();
        if(!title)return alert("Ø§Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©");
        let text=document.getElementById("noteText").value.trim();
        let id=Date.now(); notes.push({id,title,text,date:new Date().toISOString().slice(0,16)});
        localStorage.setItem("aw_notes",JSON.stringify(notes));
        renderNotes(); closeModal();
    }
    function delNote(id){
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"))return;
        notes=notes.filter(n=>n.id!=id);
        localStorage.setItem("aw_notes",JSON.stringify(notes));
        renderNotes();
    }
    window.onload=()=>{
      renderDashboard(); renderProjects(); renderTasks(); renderCalendar(); renderNotes();
    }
    </script>
</body>
</html>
