<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AliW | Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù…ÙŠ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ÙŠ</title>
<link href="https://fonts.googleapis.com/css?family=Tajawal:600,900&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
:root{
  --bg-main:#181922;--bg-side:#232435;--bg-task:#232332;--txt-main:#fff;--txt-sub:#aaa;
  --accent:#43b3fa;--card-space:#202030;--prio-high:#ef4444;--prio-med:#fbbf24;--prio-low:#42a5f5;
}
*{box-sizing:border-box}
body{background:var(--bg-main);color:var(--txt-main);font-family:'Tajawal',Arial,sans-serif;margin:0}
.header-app{display:flex;align-items:center;justify-content:space-between;background:var(--bg-side);padding:20px 22px;font-weight:900;font-size:1.18em}
.theme-switch{font-size:1.13em;border:none;background:var(--card-space);padding:6px 16px;border-radius:10px;color:var(--accent);cursor:pointer}
.layout-row{display:flex}
.sidebar{width:205px;background:var(--bg-side);height:97vh;padding-top:17px;box-shadow:-1px 0 12px #191a2220;display:flex;flex-direction:column;gap:17px;align-items:flex-start}
.logo{font-weight:900;color:var(--accent);font-size:1.17em;margin:0 0 8px 0;padding:0 18px}
.menu-list{margin-bottom:22px;width:100%;padding:0 18px}
.menu-btn{padding:12px 0;font-size:1.08em;color:var(--txt-sub);font-weight:900;border:none;width:100%;background:transparent;text-align:right;cursor:pointer;transition:.13s;font-family:'Tajawal',Arial,sans-serif}
.menu-btn.active,.menu-btn:hover{color:var(--accent)}
.main-content{flex:1;padding:45px 4vw 45px 7vw}
.section{display:none}
.section.active{display:block}
.section-title{color:var(--accent);font-weight:900;margin:0 0 17px 0;font-size:1.25em}

/* Ø§Ù„Ù…Ù‡Ø§Ù… */
.tasks-panel{background:var(--bg-task);border-radius:17px;box-shadow:0 2px 12px #1c257922;padding:0 0 24px 0;max-width:720px;margin:10px 0}
.add-task-bar{display:flex;align-items:center;gap:7px;background:var(--bg-task);padding:14px 18px 10px 18px}
.add-task-bar input[type="text"]{flex:1;padding:9px 10px;font-size:1.02em;border-radius:8px;border:1.2px solid #293848;background:var(--bg-side);color:var(--txt-main)}
.add-task-bar select{padding:8px;border-radius:8px;border:1.2px solid #293848;background:var(--bg-side);color:var(--txt-main)}
.add-task-bar button{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:8px 12px;cursor:pointer;font-size:.98em}
.tasks-list{padding:0 18px}
.task-row{display:flex;align-items:flex-start;gap:13px;padding:13px 0;border-bottom:1px solid #4446}
.task-row:last-child{border-bottom:none}
.task-check{width:25px;height:25px;background:#232435;border-radius:50%;border:1.3px solid #2787ef33;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.1s}
.task-check.checked{background:var(--accent);border-color:var(--accent)}
.task-check .material-icons{font-size:1.19em}
.task-title{font-size:1.06em;font-weight:900;margin-bottom:4px;word-break:break-word}
.task-title.done{text-decoration:line-through;color:#788b95}
.task-meta{color:var(--txt-sub);font-size:.95em;display:flex;gap:7px;align-items:center;margin-bottom:2px;flex-wrap:wrap}
.task-proj-label{display:inline-block;font-size:.90em;font-weight:800;padding:0 7px;border-radius:8px;margin-left:4px;background:#3a4258}
.task-actions{margin-right:auto}
.task-actions button{background:#272a3a;color:var(--accent);border:none;padding:2.5px 10px;border-radius:8px;cursor:pointer;font-size:.9em;margin-left:5px;font-family:'Tajawal',Arial,sans-serif}
.task-actions button.del{color:var(--prio-high)}
.badge{border:1px solid #39465a;border-radius:8px;padding:0 8px}

/* Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ */
.projects-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.project-card{background:var(--bg-task);border:1px solid #2a3142;border-radius:14px;padding:14px}
.project-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.project-dot{width:12px;height:12px;border-radius:50%}

/* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
#customModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0008;z-index:50}
#customModal.show{display:flex}
.modal-box{background:var(--bg-task);border:1px solid #2a3142;border-radius:14px;padding:16px;min-width:280px;max-width:90vw}
#modalInput{width:100%;margin:10px 0 14px;border-radius:8px;border:1px solid #2a3142;background:var(--bg-side);color:#fff;padding:10px}
.modalBtnArea{display:flex;gap:8px;justify-content:flex-end}
.modalBtnArea button{border:none;border-radius:8px;padding:8px 12px;cursor:pointer}
.cancelBtn{background:#333;color:#ddd}
#modalOkBtn{background:var(--accent);color:#fff}

/* Ø«ÙŠÙ… ÙØ§ØªØ­ Ø¨Ø³ÙŠØ· */
body[data-theme="light"]{--bg-main:#f4f6fb;--bg-side:#fff;--bg-task:#ffffff;--txt-main:#111;--txt-sub:#555;--card-space:#f1f3f8}
</style>
</head>
<body data-theme="dark">
  <!-- Modal -->
  <div id="customModal">
    <div class="modal-box">
      <span id="modalTitle" style="font-weight:900;font-size:1.05em;color:var(--accent)"></span>
      <input id="modalInput" type="text" autocomplete="off" maxlength="100" />
      <div class="modalBtnArea">
        <button class="cancelBtn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button id="modalOkBtn">Ù…ÙˆØ§ÙÙ‚</button>
      </div>
    </div>
  </div>

  <div class="header-app">
    <span>AliW | Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù…ÙŠ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ÙŠ</span>
    <button class="theme-switch" onclick="toggleTheme()" id="themeToggle">ğŸŒ™</button>
  </div>

  <div class="layout-row">
    <aside class="sidebar">
      <div class="logo">AliW</div>
      <div class="menu-list">
        <button class="menu-btn active" id="tasksMenuBtn"    onclick="setSection('tasks')">Ø§Ù„Ù…Ù‡Ø§Ù…</button>
        <button class="menu-btn"         id="projectsMenuBtn" onclick="setSection('projects')">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</button>
        <!-- Ø²Ø± Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙŠÙ†Ø´Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù† ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… -->
      </div>
    </aside>

    <main class="main-content">
      <!-- Ø§Ù„Ù…Ù‡Ø§Ù… -->
      <section class="section active" id="tasksSection">
        <h3 class="section-title">Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
        <div class="tasks-panel">
          <div class="add-task-bar">
            <input id="newTaskTitle" type="text" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø©..." />
            <select id="newTaskProject"></select>
            <button onclick="addTask()">Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div class="tasks-list" id="tasksList"></div>
        </div>
      </section>

      <!-- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
      <section class="section" id="projectsSection">
        <h3 class="section-title">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
        <div style="margin:10px 0 14px;display:flex;gap:8px">
          <input id="newProjectName" type="text" placeholder="Ø§Ø³Ù… Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #2a3142;background:var(--bg-side);color:var(--txt-main)" />
          <button onclick="addProject()" style="background:var(--accent);color:#fff;border:none;border-radius:8px;padding:10px 14px;cursor:pointer">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
        </div>
        <div class="projects-grid" id="projectsGrid"></div>
      </section>

      <!-- (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø§Ù„ØªÙ‚ÙˆÙŠÙ… -->
      <section class="section" id="calendarSection" style="display:none">
        <h3 class="section-title">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h3>
        <div id="calendarBox" class="projects-grid"></div>
      </section>
    </main>
  </div>

<script>
/* ===================== Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ù…Ø­Ù„ÙŠØ© ===================== */
const LS_KEYS = { tasks:'aliw_tasks', projects:'aliw_projects' };

function load(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback; }catch{ return fallback; } }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

let projects = load(LS_KEYS.projects, [
  {id: uid(), name:'Ø¹Ø§Ù…', color:'#3d74ff'},
]);
let tasks = load(LS_KEYS.tasks, [
  {id: uid(), title:'Ù…Ø«Ø§Ù„: Ø£ÙˆÙ„ Ù…Ù‡Ù…Ø©', projectId: projects[0]?.id, done:false, due:null, prio:'med'}
]);

/* ===================== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© ===================== */
function uid(){ return Math.random().toString(36).slice(2,10); }

function byId(id){ return document.getElementById(id); }

function toggleTheme(){
  const isDark = document.body.getAttribute('data-theme')==='dark';
  document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
  byId('themeToggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}

/* Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø³ÙŠØ· (Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ùˆ Ø§Ø­ØªØ¬ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹) */
function openModal(title, placeholder, onOk){
  byId('modalTitle').textContent = title || '';
  const input = byId('modalInput');
  input.value = '';
  input.placeholder = placeholder || '';
  byId('customModal').classList.add('show');
  const ok = byId('modalOkBtn');
  ok.onclick = ()=>{ onOk && onOk(input.value.trim()); closeModal(); };
  setTimeout(()=>input.focus(),50);
}
function closeModal(){ byId('customModal').classList.remove('show'); }

/* ===================== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ===================== */
function setSection(sec){
  // Safely remove active
  const sections = ['tasksSection','projectsSection','calendarSection'];
  sections.forEach(id => { const el = byId(id); if(el) el.classList.remove('active'); });
  const menuIds = ['tasksMenuBtn','projectsMenuBtn','calendarMenuBtn'];
  menuIds.forEach(id => { const el = byId(id); if(el) el.classList.remove('active'); });

  // Add active + render
  if(sec==='tasks'){
    byId('tasksSection').classList.add('active');
    byId('tasksMenuBtn').classList.add('active');
    renderTaskList();
    return;
  }
  if(sec==='projects'){
    byId('projectsSection').classList.add('active');
    byId('projectsMenuBtn').classList.add('active');
    renderProjectsCards();
    return;
  }
  if(sec==='calendar'){
    const cal = byId('calendarSection');
    if(cal){ cal.classList.add('active'); }
    const btn = byId('calendarMenuBtn');
    if(btn){ btn.classList.add('active'); }
    renderCalendar();
    return;
  }
}

/* Ø£Ù†Ø´Ø¦ Ø²Ø± Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù† ÙˆÙØ¬Ø¯ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
(function ensureCalendarBtn(){
  if(byId('calendarSection') && !byId('calendarMenuBtn')){
    const b = document.createElement('button');
    b.className = 'menu-btn';
    b.id = 'calendarMenuBtn';
    b.textContent = 'Ø§Ù„ØªÙ‚ÙˆÙŠÙ…';
    b.onclick = ()=>setSection('calendar');
    document.querySelector('.menu-list').appendChild(b);
  }
})();

/* ===================== Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ===================== */
function addProject(){
  const name = byId('newProjectName').value.trim();
  if(!name) return;
  const color = pickColor(projects.length);
  const p = {id: uid(), name, color};
  projects.push(p);
  save(LS_KEYS.projects, projects);
  byId('newProjectName').value = '';
  renderProjectsCards();
  rebuildProjectSelect();
}
function deleteProject(id){
  // Ù„Ø§ Ù†Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ø®ÙŠØ±
  if(projects.length<=1){ alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¢Ø®Ø± Ù…Ø´Ø±ÙˆØ¹'); return; }
  // Ø§Ù†Ù‚Ù„ Ù…Ù‡Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù„Ù‰ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹
  const fallbackId = projects.find(p=>p.id!==id)?.id;
  tasks = tasks.map(t => t.projectId===id ? {...t, projectId:fallbackId} : t);
  projects = projects.filter(p => p.id!==id);
  save(LS_KEYS.projects, projects);
  save(LS_KEYS.tasks, tasks);
  renderProjectsCards();
  rebuildProjectSelect();
}
function pickColor(i){
  const palette = ['#43b3fa','#ef4444','#fb8c00','#7d21ce','#01bc82','#f74d89','#f28021','#3d74ff','#8f36c9','#41d6c3'];
  return palette[i % palette.length];
}
function renderProjectsCards(){
  const grid = byId('projectsGrid');
  grid.innerHTML = '';
  projects.forEach(p=>{
    const card = document.createElement('div');
    card.className='project-card';
    card.innerHTML = `
      <div class="project-head">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="project-dot" style="background:${p.color}"></span>
          <strong>${escapeHtml(p.name)}</strong>
        </div>
        <button class="badge" onclick="deleteProject('${p.id}')">Ø­Ø°Ù</button>
      </div>
      <div style="color:var(--txt-sub);font-size:.93em">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…: ${tasks.filter(t=>t.projectId===p.id).length}</div>
    `;
    grid.appendChild(card);
  });
  rebuildProjectSelect();
}

/* ===================== Ø§Ù„Ù…Ù‡Ø§Ù… ===================== */
function rebuildProjectSelect(){
  const sel = byId('newTaskProject');
  if(!sel) return;
  sel.innerHTML = '';
  projects.forEach(p=>{
    const opt = document.createElement('option');
    opt.value = p.id; opt.textContent = p.name;
    sel.appendChild(opt);
  });
}
function addTask(){
  const title = byId('newTaskTitle').value.trim();
  if(!title) return;
  const projectId = byId('newTaskProject').value || projects[0]?.id;
  tasks.push({id:uid(), title, projectId, done:false, due:null, prio:'med'});
  save(LS_KEYS.tasks, tasks);
  byId('newTaskTitle').value = '';
  renderTaskList();
}
function toggleTask(id){
  tasks = tasks.map(t => t.id===id ? {...t, done:!t.done} : t);
  save(LS_KEYS.tasks, tasks);
  renderTaskList();
}
function deleteTask(id){
  tasks = tasks.filter(t => t.id!==id);
  save(LS_KEYS.tasks, tasks);
  renderTaskList();
}
function renderTaskList(){
  const list = byId('tasksList');
  list.innerHTML = '';
  // ØªØ±ØªÙŠØ¨: ØºÙŠØ± Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
  const sorted = [...tasks].sort((a,b)=> (a.done===b.done?0 : a.done?1:-1));
  sorted.forEach(t=>{
    const proj = projects.find(p=>p.id===t.projectId) || projects[0];
    const row = document.createElement('div');
    row.className='task-row';
    row.innerHTML = `
      <div class="task-check ${t.done?'checked':''}" onclick="toggleTask('${t.id}')">
        <span class="material-icons">${t.done?'check':'done'}</span>
      </div>
      <div style="flex:1">
        <div class="task-title ${t.done?'done':''}">${escapeHtml(t.title)}</div>
        <div class="task-meta">
          <span class="task-proj-label" style="background:${proj?.color || '#3a4258'}">${escapeHtml(proj?.name || 'Ø¨Ø¯ÙˆÙ†')}</span>
          ${t.due?`<span class="badge">ØªØ§Ø±ÙŠØ®: ${fmtDate(t.due)}</span>`:''}
        </div>
        <div class="task-actions">
          <button class="del" onclick="deleteTask('${t.id}')">Ø­Ø°Ù</button>
        </div>
      </div>
    `;
    list.appendChild(row);
  });
}

/* ===================== ØªÙ‚ÙˆÙŠÙ… (Ø¹Ø±Ø¶ Ø¨Ø³ÙŠØ·) ===================== */
function renderCalendar(){
  const box = byId('calendarBox');
  if(!box) return;
  box.innerHTML = '';
  // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙŠØ§Ù… 1..7 ÙƒØ£Ø¹Ù…Ø¯Ø© Ù…Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù… ØºÙŠØ± Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© ÙƒØ¹ÙŠÙ†Ø§Øª
  const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
  days.forEach((d,i)=>{
    const col = document.createElement('div');
    col.className='project-card';
    col.innerHTML = `<div class="project-head"><strong>${d}</strong></div>`;
    const ul = document.createElement('div');
    ul.style.fontSize='.92em';
    tasks.filter(t=>!t.done).slice(0,3).forEach(t=>{
      const p = projects.find(p=>p.id===t.projectId);
      const line = document.createElement('div');
      line.style.margin='8px 0';
      line.innerHTML = `<span class="project-dot" style="background:${p?.color || '#888'};display:inline-block;margin-left:6px"></span>${escapeHtml(t.title)}`;
      ul.appendChild(line);
    });
    col.appendChild(ul);
    box.appendChild(col);
  });
}

/* ===================== Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ===================== */
function fmtDate(iso){ try{ const d=new Date(iso); return d.toLocaleDateString('en-CA'); }catch{ return iso||''; } }
function escapeHtml(s){ return (s??'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ===================== Ø¥Ù‚Ù„Ø§Ø¹ ===================== */
(function init(){
  renderProjectsCards();
  rebuildProjectSelect();
  renderTaskList();
})();
</script>
</body>
</html>
