<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø³Ø§Ø­Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ù‡Ø§Ù…ÙŠ â€“ ÙƒØ§Ù†Ø¨Ø§Ù†</title>
  <link href="https://fonts.googleapis.com/css?family=Tajawal:600,900&display=swap" rel="stylesheet"/>
  <style>
:root {
  --bg-main: #f6f7fa;
  --bg-card: #fff;
  --txt-main: #232644;
  --txt-sub: #5f6188;
  --accent: #2563eb;
  --kanban-back: #f2f7fa;
  --priority-high: #e53935;
  --priority-med: #fb8c00;
  --priority-low: #2097ea;
}
[data-theme="dark"] {
  --bg-main: #191b22;
  --bg-card: #232332;
  --txt-main: #fff;
  --txt-sub: #b7bbd4;
  --accent: #43b3fa;
  --kanban-back: #22262c;
  --priority-high: #ef4444;
  --priority-med: #fbbf24;
  --priority-low: #60a5fa;
}
body {
  background: var(--bg-main);
  color: var(--txt-main);
  font-family: "Tajawal", Arial, sans-serif;
  margin: 0;
  transition:background .21s;
}
.header-app {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-card);
  padding: 24px 23px 17px 23px;
  font-weight: 900;
  font-size: 1.37em;
  border-bottom: 1.8px solid #dde1e945;
}
.theme-switch {
  font-size: 1.3em;
  border: none;
  background: var(--kanban-back);
  padding: 6px 19px;
  border-radius: 11px;
  color: var(--accent);
  cursor: pointer;
  margin-right: 12px;
}
.kanban-board {
  display: flex; gap:2vw; padding-top:44px; overflow-x:auto;
  min-height: 305px;
}
.kanban-col {
  flex: 1;
  min-width: 220px;
  background: var(--kanban-back);
  border-radius: 17px;
  padding: 12px 9px 30px 9px;
  display: flex;
  flex-direction: column;
  gap:8px;
  box-shadow: 0 2px 14px #23395b11;
}
.kanban-title {
  font-weight: 900;
  text-align: center;
  color: var(--accent);
  margin-bottom: 2px;
  letter-spacing:.04em;
  font-size: 1.05em;
  margin-top: 0;
  margin-bottom: 10px;
}
.kanban-tasks {min-height:27px;}
.kanban-task {
  background: var(--bg-card);
  color: var(--txt-main);
  border-radius: 13px;
  border: 1.1px solid #e3e6f8;
  box-shadow: 0 2px 7px #23395b10;
  padding: 13px 11px 11px 9px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-bottom: 3px;
  font-size:1.08em
}
.kanban-task[draggable="true"] {opacity:.97;box-shadow:0 6px 18px #1975fd09;}
.kb-title-row {
  display: flex;
  align-items: center;
  font-weight: bold;
  gap:5px
}
.kb-task-prio {
  border-radius: 55px;
  color: #fff;
  padding: 0px 11px 2px 11px;
  font-size:.95em;
  font-weight:700;
  margin-left:6px
}
.kb-task-prio.high {background: var(--priority-high);}
.kb-task-prio.med {background: var(--priority-med);}
.kb-task-prio.low {background: var(--priority-low);}
.kb-actions-row{display:flex;gap:3px;margin-top:4px;}
.kb-actions-row button {
  font-size:1.00em;margin-left:3px;background:#eceff675;color:var(--accent);
  border:0;padding:3px 12px 3px 12px; border-radius:8px;cursor:pointer;
}
.kb-actions-row button.del{color:var(--priority-high);}
.kb-actions-row button:active{background:var(--accent);color:#fff;}
.kb-desc {color: var(--txt-sub); font-size:.97em;}
.kb-date {color: var(--accent); font-size:0.95em;}
.kanban-add{display:flex;gap:5px;margin-top:36px;}
.kanban-add input,.kanban-add select{padding:6px 5px;font-size:1.09em;border-radius:8px;border:1.2px solid #dad4e2;}
.kanban-add button{background:var(--accent);color:#fff;padding:7px 17px 7px 17px;border-radius:8px;border:none;cursor:pointer;}
.kanban-add button:hover{background:#0e388b;}
::-webkit-scrollbar{height:8px;width:6px;background:var(--kanban-back);}
::-webkit-scrollbar-thumb{background:var(--accent);border-radius:7px;}
@media(max-width:900px){.kanban-board{gap:1vw}}
@media(max-width:700px){.kanban-board{gap:14px;}}
@media(max-width:540px){.header-app{padding:13px 4vw 11px 7vw;font-size:.99em;}.kanban-board{padding-top:8px;gap:6px;}}
  </style>
</head>
<body data-theme="light">
  <div class="header-app">
    <span>AliW | Ù†Ø¸Ø§Ù… ÙƒØ§Ù†Ø¨Ø§Ù† Ù…ØªÙ‚Ø¯Ù…</span>
    <button class="theme-switch" onclick="toggleTheme()" id="themeToggle">ğŸŒ™</button>
  </div>
  <div class="main-content">
    <div style="font-size:1.08em;color:var(--txt-sub);margin-bottom:9px;">ÙƒÙ„ Ù…Ù‡Ù…Ø© Ø¨Ù…ÙƒØ§Ù†Ù‡Ø§ ÙˆÙ…Ù†Ø¸Ù…Ø© Ø­Ø³Ø¨ Ø­Ø§Ù„ØªÙ‡Ø§ ÙˆØ£ÙˆÙ„ÙˆÙŠØªÙ‡Ø§ â€“ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§ØªØŒ ÙˆØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø¶ØºØ·Ø©!</div>
    <div class="kanban-board" id="kanbanBoard"></div>
    <form class="kanban-add" onsubmit="addTask();return false;">
      <input type="text" id="taskTitle" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ù…Ù‡Ù…Ø©" maxlength="85">
      <select id="taskPrio">
        <option value="high">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</option>
        <option value="med" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
        <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
      </select>
      <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
    </form>
    <div style="margin:25px 0 0 0;">
      <button onclick="exportTasks()" class="theme-switch">ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
      <input type="file" style="display:none;" id="importInput" accept=".json" onchange="importTasksFile(event)">
      <button onclick="document.getElementById('importInput').click()" class="theme-switch">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù</button>
    </div>
  </div>
<script>
const taskStates=["new","progress","done","hold","cancel"];
const stateLabels={
  "new":"Ø¬Ø¯ÙŠØ¯Ø©",
  "progress":"Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²",
  "done":"Ù…ÙƒØªÙ…Ù„Ø©",
  "hold":"Ù…Ø¹Ù„Ù‚Ø©",
  "cancel":"Ù…Ù„ØºØ§Ø©"
};
const prioLabels={high:"Ø¹Ø§Ù„ÙŠØ©",med:"Ù…ØªÙˆØ³Ø·Ø©",low:"Ù…Ù†Ø®ÙØ¶Ø©"};
const prioClasses={high:"high",med:"med",low:"low"};
let tasks = JSON.parse(localStorage.getItem("kanban_tasks")||"[]");
if(localStorage.getItem("theme_mode")){
  document.body.dataset.theme = localStorage.getItem("theme_mode");
  document.getElementById("themeToggle").textContent=
    document.body.dataset.theme=="dark"?"â˜€ï¸":"ğŸŒ™";
}
function toggleTheme(){
  let th=document.body.dataset.theme=="light"?"dark":"light";
  document.body.dataset.theme=th;
  document.getElementById("themeToggle").textContent=th=="dark"?"â˜€ï¸":"ğŸŒ™";
  localStorage.setItem("theme_mode",th);
}
function renderKanban() {
  let board = document.getElementById("kanbanBoard");
  board.innerHTML = "";
  taskStates.forEach(state=>{
    let col=document.createElement("div");
    col.className="kanban-col";
    col.dataset.state=state;
    col.innerHTML = `<div class="kanban-title">${stateLabels[state]}</div>
      <div class="kanban-tasks" id="tasks-${state}" ondrop="drop(event,'${state}')" ondragover="allowDrop(event)"></div>`;
    board.appendChild(col);
  });
  tasks.forEach((t,i)=>{
    let card=document.createElement("div");
    card.className="kanban-task";
    card.draggable=true;
    card.ondragstart=function(e){e.dataTransfer.setData("task-index",i);};
    card.innerHTML=`
      <div class="kb-title-row">
        <span class="kb-task-prio ${prioClasses[t.prio]}">${prioLabels[t.prio]}</span>
        <b>${t.title}</b>
      </div>
      <div class="kb-desc">${t.desc?t.desc:""}</div>
      <div class="kb-date">${t.date?t.date:""}</div>
      <div class="kb-actions-row">
        <button onclick="editTask(${i})" title="ØªØ¹Ø¯ÙŠÙ„">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="delTask(${i})" class="del" title="Ø­Ø°Ù">Ø­Ø°Ù</button>
      </div>
    `;
    document.getElementById("tasks-"+t.state).appendChild(card);
  });
}
function addTask(){
  let title=document.getElementById("taskTitle").value.trim();
  let prio=document.getElementById("taskPrio").value;
  if(!title) return alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ù…Ù‡Ù…Ø©");
  tasks.push({title,prio,state:"new",desc:"",date:new Date().toLocaleString("ar-EG")});
  localStorage.setItem("kanban_tasks",JSON.stringify(tasks));
  document.getElementById("taskTitle").value="";
  renderKanban();
}
function delTask(i){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ"))return;
  tasks.splice(i,1);
  localStorage.setItem("kanban_tasks",JSON.stringify(tasks));
  renderKanban();
}
function editTask(i){
  let t=tasks[i];
  let newTitle = prompt("ØªØ¹Ø¯ÙŠÙ„ Ù†Øµ Ø§Ù„Ù…Ù‡Ù…Ø©",t.title);
  if(newTitle!=null&&newTitle.trim()){
    t.title=newTitle;
    localStorage.setItem("kanban_tasks",JSON.stringify(tasks));
    renderKanban();
  }
}
function allowDrop(evt){evt.preventDefault();}
function drop(evt, newState){
  evt.preventDefault();
  let idx=+evt.dataTransfer.getData("task-index");
  tasks[idx].state=newState;
  localStorage.setItem("kanban_tasks",JSON.stringify(tasks));
  renderKanban();
}
function exportTasks(){
  let data=JSON.stringify(tasks,null,2);
  let a=document.createElement("a");
  a.href="data:application/json,"+ encodeURIComponent(data);
  a.download="kanban_tasks.json";
  a.click();
}
function importTasksFile(e){
  let file = e.target.files[0];
  if(!file)return;
  let reader=new FileReader();
  reader.onload = function(evt){
    try{
      let arr=JSON.parse(evt.target.result);
      if(!Array.isArray(arr)||!arr[0].title)throw "Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­";
      tasks=arr;
      localStorage.setItem("kanban_tasks",JSON.stringify(tasks));
      renderKanban();
      alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    }catch{alert("Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…");}
  };
  reader.readAsText(file);
}
window.onload=renderKanban;
</script>
</body>
</html>
