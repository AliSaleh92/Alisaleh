<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Workspace - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css?family=Tajawal:400,500,700,900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin:0; padding:0; min-height:100vh;
            font-family:'Tajawal',sans-serif; background:
                linear-gradient(135deg, #ddd6f3 0%, #faaca8 100%) fixed;
            background-size:cover;
        }
        .glass {background: rgba(255,255,255,0.66);box-shadow:0 8px 48px #764ba233, 0 0 1px #fff;border-radius: 22px;backdrop-filter: blur(8px);-webkit-backdrop-filter: blur(8px);border: 1.5px solid rgba(163,126,241, .09);}
        .sidebar {position:fixed;right:0;top:0;width:70px;height:100vh;z-index:250;display:flex;flex-direction:column;align-items:center;gap:15px;background:rgba(255,255,255,0.15);backdrop-filter:blur(8px);box-shadow:-4px 0 24px #9d78e91a;}
        .logo {font-size:1.4em;font-weight:900;letter-spacing:2px;margin-bottom:31px;margin-top:20px; color:#7239f7;}
        .menu {list-style:none;margin:0;padding:0;width:100%;}
        .menu-item {width:96%;margin:2px auto 0;display:flex;align-items:center;justify-content:center;padding:17px 4px;border-radius:14px;font-size:1.3em;cursor:pointer;transition:background .15s,color .09s;color:#6a628c;}
        .menu-item.active, .menu-item:hover {background:linear-gradient(90deg, #ae81ff11 30%,#e3d0ff11 100%);color:#7239f7;}
        .main-content {margin-right:80px;padding:35px 7vw 65px 10vw; min-height:100vh;}
        .header {display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
        .header h2 {margin:0; font-size:2.2em; color:#6a628c; font-weight:800; letter-spacing:.5px;}
        /* Glass Card Modern Grid */
        .dashboard-glass {padding:38px 18px;margin-top:3vw;}
        .stats {display:flex;gap:3.7vw;flex-wrap:wrap;margin-bottom:29px;justify-content:center;}
        .stat {background:#fff7f9aa;border-radius:23px;padding:23px 0 19px 0;box-shadow:0 4px 18px #996aec09;width:170px;text-align:center; font-weight:600;}
        .stat-val {font-size:2.3em;margin:13px 0 7px 0;color:#8626D5;font-weight:900;}
        /* Projects */
        .proj-tabs {display:flex;gap:17px;margin-bottom:26px;overflow-x:auto;}
        .proj-tab {padding:13px 38px;background:linear-gradient(145deg,#fbf9ff 65%,#efeafd 100%);border-radius:23px 23px 0 0;cursor:pointer;font-weight:800;font-size:1.13em;box-shadow:0 18px 36px #f0eafd38;border:2.2px solid #af77ff18;border-bottom:none;color:#58487c;position:relative;letter-spacing:.5px;}
        .proj-tab.selected {background: #fff; color:#a877e1; box-shadow:0 40px 64px #9e6afd21,0 1px 0 #fff;}
        .proj-state {display:inline-block; padding:3px 15px; border-radius:9px; font-size:0.95em; margin-right:7px;font-weight:700;}
        .proj-state.active {background:#75e13d;color:#fff;}  .proj-state.done {background:#ddf;color:#444;}
        .proj-state.paused {background:#ffe962;color:#6d570c;}
        .proj-color-dot {width:21px;height:21px;border-radius:50%;display:inline-block;margin-left:9px;vertical-align:middle;box-shadow:0 0 0 2px #ececec;}
        .proj-edit-btn {margin-right:9px;padding:4px 13px;border-radius:8px;background:#ececff;font-weight:700;border:none;cursor:pointer;}
        /* Ideas Table and filter */
        .ideas-filterbar{display:flex;gap:7px;align-items:center;margin-bottom:14px;color:#8d77bc;}
        .ideas-section {margin-top:13px;padding:25px 18px 18px 16px;}
        .ideas-table {width:100%;margin-top:5px;background:#f7fafc;border-radius:17px;border-collapse:collapse;font-size:1.15em;}
        .ideas-table th, .ideas-table td{padding:13px 7px;border-bottom:1px solid #ececec;text-align:center;}
        .ideas-table th {background: #6a62df; color:#fff; font-weight:800;}
        .empty-txt{text-align:center;color:#b9b1da;font-size:1.13em;padding:4px;}
        .idea-status {border-radius:12px;padding:5px 15px;font-weight:700;font-size:1em;border:none;}
        .idea-status.Ø¬Ø¯ÙŠØ¯{background:#f2dcff;color:#af3ab3;}
        .idea-status.Ù‚ÙŠØ¯\ Ø§Ù„Ø§Ù†Ø¬Ø§Ø²{background:#cdedfc;color:#1c6a83;}
        .idea-status.ØªÙ…\ Ø§Ù„Ø§Ù†Ø¬Ø§Ø²{background:#cdfbe8;color:#248a3e;}
        .idea-status.Ù…Ø¹Ù„Ù‚{background:#fff5be;color:#947a13;}
        .idea-status.Ù…Ù„ØºÙŠ{background:#ffe1e1;color:#d36666;}
        /* MODAL */
        .modal-bg {position:fixed;top:0;right:0;left:0;bottom:0;background:rgba(70,40,90,.15);z-index:999;}
        .modal-box {position:fixed;top:50%;right:50%;transform:translate(50%,-50%);background:#fffefeb2;padding:36px 22px 28px 22px;border-radius:26px;box-shadow:0 16px 64px #ae7fff3e;z-index:1200;width:385px;max-width:96vw;
            border:2px solid #ece1fa;text-align:right;backdrop-filter:blur(8px);}
        .modal-box label {font-weight:700;margin:7px 0 0 0;display:inline-block;}
        .modal-box input, .modal-box textarea,
        .modal-box select {font-size:1em;padding:8px 7px;margin:8px 0 14px 0;
            border-radius:11px; border:1.4px solid #ece1fa;width:97.5%;}
        .modal-btn-bar{display:flex;justify-content:right;gap:11px;margin-top:13px;}
        .add-fab {position:fixed;bottom:29px;left:7vw;width:67px;height:67px;background:linear-gradient(135deg,#a877e1 0%,#50e3c2 100%);color:#fff;display:flex;align-items:center;justify-content:center;font-size:2.36em;
            border:none;border-radius:50%;box-shadow:0 8px 30px #8f56cf50;cursor:pointer;z-index:990;transition:box-shadow .2s;}
        .add-fab:hover {box-shadow:0 14px 42px #8f56cf92;}
        /* Ø§Ù„Ù…Ù‡Ø§Ù… */
        .task-item.glass {margin-bottom:13px;padding:19px 20px;display:flex;align-items:flex-start;flex-direction:column;box-shadow:0 6px 22px #9e6afd29!important;}
        .task-top-row{display:flex;align-items:center;width:100%;justify-content:space-between;}
        .task-label-proj{background:#a877e1;color:#fff;border-radius:15px;padding:3px 13px;font-weight:700;letter-spacing:.2px;}
        .task-done .task-label-proj{opacity:.6;}
        .task-date {font-size:.97em;color:#988;margin-right:13px;}
        .notes-tit{font-size:1.06em;font-weight:700;margin:8px 0 0 0;color:#a877e1;}
        .notes-list{margin:0 0 6px 0;padding:0;list-style:none;}
        .note-li{background:#f4f2f5;border-radius:11px;padding:5px 11px;margin:2px 0;color:#625b69;font-size:.98em;}
        .note-li small{color:#caa;margin-left:12px;}
        /* BottomBar Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 968px){
            .main-content{padding:24px 7px 70px 7px;}
        }
        @media (max-width: 700px){
            .main-content{margin:0;padding:10px 2vw 66px 2vw;}
            .sidebar {top:auto;bottom:0;right:0;left:0;width:100vw;height: 69px;flex-direction:row;gap:12px;padding:13px 0;background:rgba(255,255,255,.24);}
            .logo{display:none}
            .menu {display:flex;flex-direction:row;gap:0;width:100%;justify-content:space-around;}
            .menu-item {width:100%;text-align:center;padding:14px 2px;border-radius:15px;font-size:1.1em;}
        }
    </style>
</head>
<body>
    <div class="sidebar glass">
        <div class="logo">Ali Workspace</div>
        <ul class="menu">
            <li class="menu-item active" onclick="showSection('dashboard')"><span>ğŸ“Š</span></li>
            <li class="menu-item" onclick="showSection('projects')"><span>ğŸ“</span></li>
            <li class="menu-item" onclick="showSection('tasks')"><span>âœ…</span></li>
            <li class="menu-item" onclick="showSection('calendar')"><span>ğŸ“…</span></li>
            <li class="menu-item" onclick="showSection('notes')"><span>ğŸ“</span></li>
        </ul>
    </div>
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="dashboard-glass glass">
                <div class="header"><h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</h2></div>
                <div class="stats">
                    <div class="stat"><div>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="stat-val" id="statProjects">0</div></div>
                    <div class="stat"><div>Ø§Ù„Ù…Ù‡Ø§Ù…</div><div class="stat-val" id="statTasks">0</div></div>
                    <div class="stat"><div>Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="stat-val" id="statDone">0</div></div>
                </div>
                <canvas id="chartTasks" height="82"></canvas>
            </div>
        </div>
        <!-- Projects Section -->
        <div id="projects" class="section">
            <div class="header">
                <h2>ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
            </div>
            <div class="proj-tabs" id="projTabs"></div>
            <div class="ideas-filterbar" id="ideasFilterBar"></div>
            <div id="projContent"></div>
        </div>
        <!-- Tasks Section -->
        <div id="tasks" class="section">
            <div class="header"><h2>âœ… Ø§Ù„Ù…Ù‡Ø§Ù…</h2></div>
            <div class="task-grid glass" style="margin-top:20px;">
                <div class="task-head" style="display:flex;align-items:center;gap:16px;">
                    <select id="tasksProjSelect" onchange="renderTasks()"></select>
                    <span><input type="checkbox" id="showDoneChk" onchange="renderTasks()"> Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                </div>
                <div class="task-list" id="taskList"></div>
            </div>
        </div>
        <!-- Calendar Section -->
        <div id="calendar" class="section">
            <div class="header"><h2>ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h2></div>
            <div class="calendar-nav">
                <button onclick="moveMonth(-1)">âŸ¨</button>
                <span id="calendarMonthYear"></span>
                <button onclick="moveMonth(1)">âŸ©</button>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
            <div style="margin-top:16px"><ul id="calendarDayTasks"></ul></div>
        </div>
        <!-- Notes Section -->
        <div id="notes" class="section"><div class="header notes-head"><h2>ğŸ“ Ø¯ÙØªØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2></div><div class="note-grid" id="noteGrid"></div></div>
    </div>
    <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ù… -->
    <button class="add-fab" id="addFab" title="Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯">ï¼‹</button>
    <script>
    let projects = JSON.parse(localStorage.getItem("aw_projects")||"[]");
    let tasks = JSON.parse(localStorage.getItem("aw_tasks")||"[]");
    let notes = JSON.parse(localStorage.getItem("aw_notes")||"[]");
    let selectedProj = projects.length?projects[0].id:null;
    let ideaStatusArr = ["Ø¬Ø¯ÙŠØ¯","Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¬Ø§Ø²","ØªÙ… Ø§Ù„Ø§Ù†Ø¬Ø§Ø²","Ù…Ø¹Ù„Ù‚","Ù…Ù„ØºÙŠ"];
    let filterIdeaStat = "";
    // ---[ Ø§Ù„Ù†Ø¸Ø§Ù… ]---
    function showSection(sec) {
        document.querySelectorAll('.menu-item').forEach((e,i)=>{e.classList.remove('active');if(i==["dashboard","projects","tasks","calendar","notes"].indexOf(sec))e.classList.add('active');});
        document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
        document.getElementById(sec).classList.add('active');
        if(sec==="dashboard") renderDashboard();
        if(sec==="projects") { renderProjTabs(); renderIdeasFilterBar(); renderProjContent();}
        if(sec==="tasks") renderTasks();
        if(sec==="calendar") renderCalendar();
        if(sec==="notes") renderNotes();
        document.getElementById('addFab').style.display=(sec==="notes"||sec==="tasks"||sec==="projects")?"block":"none";
    }
    // --- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ---
    function renderProjTabs() {
        let tabs = document.getElementById("projTabs");
        if(!projects.length) { tabs.innerHTML = "<span class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹.</span>"; return; }
        tabs.innerHTML = projects.map(proj =>
            `<div class="proj-tab glass${selectedProj==proj.id?' selected':''}" onclick="selectProject(${proj.id})">
                <span class="proj-color-dot" style="background:${proj.color||'#ae84fa'}"></span>
                ${proj.name}
                <span class="proj-state ${proj.status}">${proj.statusTxt||"Ù†Ø´Ø·"}</span>
                <button class="proj-edit-btn" onclick="event.stopPropagation();editProjectPrompt(${proj.id})">ØªØ­Ø±ÙŠØ±</button>
            </div>`
        ).join("");
    }
    function selectProject(id) {
        selectedProj = id;
        renderProjTabs();
        renderIdeasFilterBar();
        renderProjContent();
    }
    function getProjectIdeas(projId) {return JSON.parse(localStorage.getItem('aw_ideas_'+projId)||"[]");}
    function setProjectIdeas(projId, ideas) {localStorage.setItem('aw_ideas_'+projId, JSON.stringify(ideas));}
    function renderIdeasFilterBar() {
        let bar = document.getElementById("ideasFilterBar");
        if(!selectedProj) {bar.innerHTML="";return;}
        bar.innerHTML = 'ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©:' +
            `<select style="padding:6px 10px;font-size:1em;border-radius:10px;" onchange="filterIdeaStat=this.value;renderProjContent()">
            <option value="">Ø§Ù„ÙƒÙ„</option>
            ${ideaStatusArr.map(v=>`<option${filterIdeaStat==v?' selected':''}>${v}</option>`).join('')}
            </select>`;
    }
    function renderProjContent() {
        let container = document.getElementById("projContent");
        let proj = projects.find(p=>p.id==selectedProj);
        if(!proj) { container.innerHTML="<span class='empty-txt'>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙØªØ±.</span>"; return;}
        let ideas = getProjectIdeas(proj.id);
        if(filterIdeaStat) ideas=ideas.filter(i=>i.status==filterIdeaStat);
        container.innerHTML = `
            <div class="ideas-section glass">
              <div style="font-weight:900;margin-bottom:13px;font-size:1.25em;color:${proj.color||'#8926f7'}">Ø¯ÙØªØ± ØªØªØ¨Ø¹ Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ù„Ù…Ø´Ø±ÙˆØ¹ <span>${proj.name}</span></div>
              <table class="ideas-table">
                <tr>
                  <th>Ø§Ù„ÙÙƒØ±Ø©</th>
                  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                </tr>
                ${ideas.map((i,idx)=>
                `<tr>
                  <td>${i.text}</td>
                  <td>
                  <select class="idea-status ${i.status}" onchange="updateIdeaStatus(${proj.id},${idx},this.value)">
                    ${ideaStatusArr.map(st=>`<option${i.status==st?' selected':''}>${st}</option>`).join('')}
                  </select>
                  </td>
                  <td>${i.date||"-"}</td>
                </tr>`
                ).join("")}
              </table>
              ${ideas.length===0?'<div class="empty-txt">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹!</div>':''}
            </div>
        `;
    }
    function updateIdeaStatus(pid,idx,value){
        let ideas=getProjectIdeas(pid);
        ideas[idx].status=value;
        setProjectIdeas(pid,ideas);
        renderProjContent();
    }
    // --- Ø¥Ø¶Ø§ÙØ© + ØªØ­Ø±ÙŠØ± Ù…Ø´Ø±ÙˆØ¹ ---
    function openProjectModal(proj,edit=false){
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.26em;font-weight:800;margin-bottom:13px">${edit?'ØªØ¹Ø¯ÙŠÙ„':'Ø¥Ø¶Ø§ÙØ©'} Ù…Ø´Ø±ÙˆØ¹</div>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <input id="projName" value="${proj?.name||''}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" maxlength="24"/><br>
            <label>Ø§Ù„ÙˆØµÙ</label>
            <input id="projDesc" value="${proj?.desc||''}" placeholder="ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"/><br>
            <label>Ù„ÙˆÙ† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <input id="projColor" value="${proj?.color||'#ae84fa'}" type="color" style="width:70px"/><br>
            <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select id="projStatus">
              ${['active','paused','done'].map(s=>`<option value="${s}"${proj?.status==s?' selected':''}>${s=='active'?'Ù†Ø´Ø·':s=='paused'?'Ù…Ø¹Ù„Ù‚':'Ù…Ù†ØªÙ‡ÙŠ'}</option>`).join('')}
            </select>
            <div class="modal-btn-bar">
              <button onclick="${edit?'saveProjectEdit('+proj.id+')':'saveProjectAdd()'}" class="add-btn">${edit?'Ø­ÙØ¸':'Ø¥Ø¶Ø§ÙØ©'}</button>
              <button onclick="closeModal()" style="background:#eee;color:#a877e1;border-radius:10px;">Ø¥Ù„ØºØ§Ø¡</button>
              ${edit?`<button onclick="delProject(${proj.id})" style="background:#fdeded;color:#d66;border-radius:10px;margin-right:auto;">Ø­Ø°Ù</button>`:""}
            </div>
        `;
        document.body.append(bg,modal);
        window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function saveProjectAdd(){
        let name=document.getElementById("projName").value.trim();
        if(!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹");
        let desc=document.getElementById("projDesc").value.trim();
        let color=document.getElementById("projColor").value;
        let stat=document.getElementById("projStatus").value;
        let statTxt = stat=="active"?"Ù†Ø´Ø·":stat=="paused"?"Ù…Ø¹Ù„Ù‚":"Ù…Ù†ØªÙ‡ÙŠ";
        let id=Date.now();
        projects.push({id,name,desc,color,status:stat,statusTxt:statTxt});
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        selectedProj=id;
        renderProjTabs(); renderIdeasFilterBar(); renderProjContent(); renderDashboard();
        closeModal();
    }
    function editProjectPrompt(id){ openProjectModal(projects.find(p=>p.id==id),true);}
    function saveProjectEdit(id){
        let name=document.getElementById("projName").value.trim();
        if(!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹");
        let desc=document.getElementById("projDesc").value.trim();
        let color=document.getElementById("projColor").value;
        let stat=document.getElementById("projStatus").value;
        let statTxt = stat=="active"?"Ù†Ø´Ø·":stat=="paused"?"Ù…Ø¹Ù„Ù‚":"Ù…Ù†ØªÙ‡ÙŠ";
        let i=projects.findIndex(p=>p.id==id);
        projects[i]={...projects[i],name,desc,color,status:stat, statusTxt:statTxt};
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        renderProjTabs(); renderIdeasFilterBar(); renderProjContent(); renderDashboard();
        closeModal();
    }
    function delProject(id){
        if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆÙƒÙ„ Ø£ÙÙƒØ§Ø±Ù‡ØŸ"))return;
        projects=projects.filter(p=>p.id!=id);
        localStorage.setItem("aw_projects",JSON.stringify(projects));
        localStorage.removeItem('aw_ideas_'+id);
        if(selectedProj==id)selectedProj=projects.length?projects[0].id:null;
        renderProjTabs(); renderIdeasFilterBar(); renderProjContent(); renderDashboard();
        closeModal();
    }
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…
    document.getElementById("addFab").onclick = function(){
        let sec = document.querySelector('.section.active').id;
        if(sec=="projects") openProjectModal();
        if(sec=="tasks") openTaskModal();
        if(sec=="notes") openNoteModal();
    }
    // Ø§Ù„Ù…Ù‡Ø§Ù…: Ø¥Ø¶Ø§ÙØ© + Ø¹Ø±Ø¶
    let tempNotes = [];
    function openTaskModal(){
        tempNotes = [];
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.18em;font-weight:800;margin-bottom:15px">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</div>
            <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <select id="taskProj">${projects.map(p=>`<option value="${p.id}" style="background:${p.color}">${p.name}</option>`)}</select>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
            <input id="taskName" maxlength="42"/>
            <label>ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
            <textarea id="taskDesc" rows="2"></textarea>
            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
            <input id="taskDate" type="date"/>
            <label>Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
            <select id="taskRepeat">
                <option>Ø¨Ø¯ÙˆÙ†</option><option>ÙŠÙˆÙ…ÙŠ</option><option>Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option><option>Ø´Ù‡Ø±ÙŠ</option>
            </select>
            <label>Ù…Ø±ÙÙ‚/Ø±Ø§Ø¨Ø·</label>
            <input id="taskAttach" type="text" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø£Ùˆ ÙˆØµÙ Ù…Ø®ØªØµØ±" />
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ù…Ù‡Ù…Ø© (Ø§Ø¶ØºØ· Enter Ù„Ù„ØªØ³Ø¬ÙŠÙ„)</label>
            <textarea id="taskNoteInput" rows="1" onkeyup="if(event.key=='Enter'){addTaskNote();}"></textarea>
            <ul id="taskNotesList" style="margin:0;list-style:none;padding:0;"></ul>
            <div class="modal-btn-bar">
                <button onclick="saveTaskAdd()" class="add-btn">Ø¥Ø¶Ø§ÙØ©</button>
                <button onclick="closeModal()" style="background:#eee;color:#a877e1;border-radius:10px;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.body.append(bg,modal);
        window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function addTaskNote(){
        let txt=document.getElementById('taskNoteInput').value.trim();
        if(!txt)return;
        let d=new Date();
        let now=d.toLocaleString('ar-SA',{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});
        tempNotes.push({text:txt,date:now});
        renderTaskNotes();
        document.getElementById('taskNoteInput').value="";
    }
    function renderTaskNotes(){
        let lst=document.getElementById('taskNotesList');
        lst.innerHTML=tempNotes.map(n=>`<li class="note-li">
          <span>${n.text}</span>
          <small>${n.date}</small>
        </li>`).join('');
    }
    function saveTaskAdd(){
        let pId = +document.getElementById("taskProj").value;
        let name = document.getElementById("taskName").value.trim();
        let desc = document.getElementById("taskDesc").value.trim();
        let date = document.getElementById("taskDate").value;
        let repeat = document.getElementById("taskRepeat").value;
        let attach = document.getElementById("taskAttach").value.trim();
        if(!name) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©");
        let id=Date.now();
        let notes=tempNotes.slice();
        tasks.push({id,projectId:pId,name,desc,date,repeat,attach,notes,done:false});
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        tempNotes=[];
        renderTasks();renderDashboard();
        closeModal();
    }
    function renderTasks() {
        let select=document.getElementById("tasksProjSelect");
        select.innerHTML=projects.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
        let showDone=document.getElementById("showDoneChk").checked;
        let currentProj=+select.value||(projects[0]?projects[0].id:0);
        let list=document.getElementById("taskList");
        let filtered=tasks.filter(t=>t.projectId==currentProj && (showDone||!t.done));
        if(!filtered.length) { list.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return;}
        list.innerHTML=filtered.map(t=>{
            let proj=projects.find(p=>p.id==t.projectId);
            return `<div class="task-item glass ${t.done?'task-done':''}">
                <div class="task-top-row">
                    <span class="task-label-proj" style="background:${proj.color}">${proj.name}</span>
                    <span>${t.date?'<span class="task-date">'+t.date+'</span>':''}</span>
                </div>
                <div style="margin:7px 0;font-weight:800">${t.name}</div>
                <div style="color:#886a; margin-bottom:6px">${t.desc}</div>
                ${(t.repeat&&t.repeat!='Ø¨Ø¯ÙˆÙ†')?`<span style="background:#e1f7eb;color:#166;font-size:.98em;padding:2px 14px;border-radius:10px;margin-bottom:4px;display:inline-block">ØªÙƒØ±Ø§Ø±: ${t.repeat}</span>`:""}
                ${(t.attach)?'<div style="margin-bottom:7px"><a href="'+t.attach+'" target="_blank" style="color:#a877e1;text-decoration:underline">Ø§Ù„Ù…Ø±ÙÙ‚/Ø§Ù„Ø±Ø§Ø¨Ø·</a></div>':''}
                <div class="notes-tit">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
                <ul class="notes-list">${(t.notes||[]).map(n=>`<li class="note-li">${n.text}<small>${n.date}</small></li>`).join('')}</ul>
                <div><button onclick="toggleTask(${t.id})">${t.done?'â':'âœ”ï¸'}</button>
                <button onclick="delTask(${t.id})" style="color:#d66;background:none;border:none;">Ø­Ø°Ù</button></div>
            </div>`;
        }).join("");
    }
    function delTask(id){
        if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
        tasks=tasks.filter(t=>t.id!=id);
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        renderTasks(); renderDashboard();
    }
    function toggleTask(id){
        let t=tasks.find(t=>t.id==id);
        t.done=!t.done;
        localStorage.setItem("aw_tasks",JSON.stringify(tasks));
        renderTasks(); renderDashboard();
    }
    // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: Ø¥Ø¶Ø§ÙØ© + Ø¹Ø±Ø¶
    function openNoteModal(){
        let bg=document.createElement('div');
        bg.className='modal-bg';
        let modal=document.createElement('div');
        modal.className='modal-box';
        modal.innerHTML=`
            <div style="font-size:1.19em;font-weight:800;margin-bottom:11px">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</div>
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label><input id="noteTitle"/><br>
            <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label><textarea id="noteText" rows="3"></textarea>
            <div class="modal-btn-bar">
            <button onclick="saveNoteAdd()" class="add-btn">Ø¥Ø¶Ø§ÙØ©</button>
            <button onclick="closeModal()" style="background:#eee;color:#a877e1;border-radius:10px;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        `;
        document.body.append(bg,modal);
        window.closeModal=()=>{modal.remove();bg.remove();}
    }
    function saveNoteAdd(){
        let title=document.getElementById("noteTitle").value.trim();
        if(!title)return alert("Ø§Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©");
        let text=document.getElementById("noteText").value.trim();
        let id=Date.now(); notes.push({id,title,text,date:new Date().toISOString().slice(0,16)});
        localStorage.setItem("aw_notes",JSON.stringify(notes));
        renderNotes();
        closeModal();
    }
    function renderNotes(){
        let grid=document.getElementById("noteGrid");
        if(!notes.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</p>";return;}
        grid.innerHTML=notes.map(n=>`
            <div class="note-card glass" style="padding:17px;margin-bottom:13px;">
              <div class="note-title" style="font-weight:700">${n.title}</div>
              <div style="color:#635;font-size:1em;">${n.text}</div>
              <div style="font-size:0.89em;color:#ae92bb;margin-top:6px">ØªØ§Ø±ÙŠØ®: ${n.date}</div>
              <button onclick="delNote(${n.id})" style="color:#c66;margin-top:7px;border:none;background:none;font-size:1em;">Ø­Ø°Ù</button>
            </div>
        `).join("");
    }
    function delNote(id){
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"))return;
        notes=notes.filter(n=>n.id!=id);
        localStorage.setItem("aw_notes",JSON.stringify(notes));
        renderNotes();
    }
    function renderDashboard(){
        document.getElementById("statProjects").textContent=projects.length;
        document.getElementById("statTasks").textContent=tasks.length;
        document.getElementById("statDone").textContent=tasks.filter(t=>t.done).length;
        let ctx=document.getElementById("chartTasks").getContext('2d');
        if(window.tasksChart) window.tasksChart.destroy();
        window.tasksChart=new Chart(ctx,{
            type:"doughnut",
            data:{
                labels:["ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©","Ù…ÙƒØªÙ…Ù„Ø©"],
                datasets:[{
                    data:[tasks.length-tasks.filter(t=>t.done).length,tasks.filter(t=>t.done).length],
                    backgroundColor:["#fafafa","#50e3c2"]
                }]
            },
            options:{responsive:true,plugins:{legend:{position:"bottom"}}}
        });
    }
    let calDate=new Date();
    function moveMonth(val){calDate.setMonth(calDate.getMonth()+val);renderCalendar();}
    function renderCalendar(){
        let d=new Date(calDate);d.setDate(1);let month=d.getMonth(),year=d.getFullYear();
        document.getElementById("calendarMonthYear").textContent = `${year} - ${month+1}`;
        let days=[];for(let i=0;i<d.getDay();i++)days.push("");
        let lastDay=new Date(year,month+1,0).getDate();
        for(let i=1;i<=lastDay;i++)days.push(i);
        let today=new Date();let tDay=today.getDate(),tMonth=today.getMonth(),tYear=today.getFullYear();
        let html="";
        days.forEach(val=>{
            let isToday=val==tDay&&month==tMonth&&year==tYear;
            let dayTasks=tasks.filter(t=>t.date==`${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}`);
            html+=`<div class="day-cell${isToday?' today':''}" onclick="showTasksForDay('${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}')">${val}${dayTasks.length?' <span style="color:#f56565">â—</span>':''}</div>`
        });
        document.getElementById("calendarDays").innerHTML=html;
        document.getElementById("calendarDayTasks").innerHTML="";
    }
    function showTasksForDay(date){
        let dayTasks=tasks.filter(t=>t.date==date);
        let list=document.getElementById("calendarDayTasks");
        if(!dayTasks.length) {list.innerHTML="<li class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</li>";return;}
        list.innerHTML=dayTasks.map(t=>`<li>${t.name} (${projects.find(p=>p.id==t.projectId)?.name||""})</li>`).join("");
    }
    window.onload=()=>{
       renderDashboard(); renderProjTabs(); renderIdeasFilterBar(); renderProjContent();
       renderTasks(); renderCalendar(); renderNotes();
       document.getElementById('addFab').style.display='block';
    };
    </script>
</body>
</html>
