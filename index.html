<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Workspace - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f7f9fa;
        }
        .sidebar {
            position: fixed; right: 0; top: 0; width: 64px; height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff; padding: 24px 6px 32px 6px; box-shadow: -2px 0 15px #667eea21;
            z-index: 200; display: flex; flex-direction: column; gap: 19px; align-items: center; transition: width 0.18s;
        }
        .sidebar:hover, .sidebar:focus-within { width: 220px;}
        .logo { text-align: center; margin-bottom: 32px; font-size: 1.6em; font-weight: bold; }
        .menu { list-style: none; padding: 0; width: 100%; }
        .menu-item { padding: 14px 9px 14px 12px; border-radius: 9px; margin-bottom: 9px; cursor: pointer; font-size: 1.1em;  transition: background 0.15s,color .15s;}
        .menu-item.active, .menu-item:hover { background:rgba(255,255,255,.15); color: #fff; }
        .menu-item span { margin-right: 8px;}
        .main-content { margin-right: 64px; padding: 32px 18px; min-height: 100vh; transition: margin-right .18s;}
        .sidebar:hover ~ .main-content {margin-right: 220px;}
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px;}
        .header h2 {margin: 0; font-size:2.15em;color:#667eea;}
        .section {display:none;}
        .section.active {display:block; animation:fadeIn .4s;}
        @keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
        .add-btn { padding:9px 18px; font-size:1em; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border:none; border-radius:18px; cursor:pointer; margin-bottom:15px; font-weight: bold; box-shadow:0 2px 14px #764ba248;}
        .stats {display: flex; gap: 20px; flex-wrap: wrap; margin-bottom:32px;}
        .stat { background:#fff; border-radius:14px; padding:18px; box-shadow:0 3px 15px #667eea11; width:170px; text-align:center;}
        .stat-val { font-size:2em; margin:8px 0; color:#764ba2;}
        .proj-tabs {display: flex; gap: 17px; overflow-x: auto; margin-bottom: 26px;}
        .proj-tab {padding:13px 36px; background:linear-gradient(135deg,#fff 30%,#f6f1fa 100%);
            border-radius:15px 15px 0 0; cursor:pointer; font-weight:bold; font-size:1.09em;
            box-shadow:0 2px 6px #0001; transition:background .2s, box-shadow .2s;
            border: 2.5px solid transparent; border-bottom: none;
            color: #454; position:relative;}
        .proj-tab.selected {
            background: #fff; color:#764ba2; border-color: #a892ef #a892ef #fff #a892ef;
            box-shadow:0 12px 22px #9980fa28, 0 1px 0 #fff;
        }
        .proj-state {
            display:inline-block; padding:2px 12px; border-radius:9px; font-size:.98em; margin-left:10px;margin-right:6px;font-weight:500;
        }
        .proj-state.active { background:#48bb78; color:#fff;}
        .proj-state.done { background:#ccd; color:#444;}
        .proj-state.paused { background:#faed5c; color:#555;}
        .proj-color-dot { width:20px;height:20px;border-radius:50%;display:inline-block;margin-right:8px;box-shadow:0 0 0 2px #eee;}
        .ideas-section {background:#f9f8ff;padding:13px 12px 21px 14px;margin-top:14px;border-radius:18px; box-shadow:0 4px 14px #667eea24;}
        .ideas-table {width:100%;margin-top:10px;background:#fbfafb;border-radius:12px;border-collapse:collapse; font-size:1.02em;}
        .ideas-table th, .ideas-table td{padding:9px 7px;border-bottom:1px solid #ececec;}
        .ideas-table th {background:#6a59c2;color:#fff;}
        .ideas-table tr:last-child td{border-bottom:0;}
        .ideas-table td button {padding:4px 12px; border-radius:8px; border:none; background:#667eea; color:#fff; cursor:pointer;}
        .ideas-table td:last-child button {background: #48bb78;}
        .empty-txt {text-align:center;color:#bbb;font-size:1em;padding:6px;}
        /* Modal styles */
        .modal-bg {
            position:fixed;top:0;right:0;left:0;bottom:0;
            background:rgba(0,0,0,.11);z-index:900;
        }
        .modal-box {
            position:fixed;top:50%;right:50%;transform:translate(50%,-50%);
            background:#fff;padding:28px 20px;border-radius:18px;box-shadow:0 9px 28px #0002;z-index:999;width:360px;max-width:93vw;
        }
        /* Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù†ÙØ³Ù‡Ø§ Ù„Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
        .task-grid { background:#fff; border-radius:18px; padding:16px; box-shadow:0 4px 18px #667eea14;}
        .task-head {display:flex;align-items:center; justify-content:space-between;}
        .task-list {margin-top:12px;}
        .task-item {background:#f7f7fc; margin-bottom:8px;padding:13px; border-radius:13px; display:flex;align-items:center; justify-content:space-between; transition:box-shadow .13s;}
        .task-item:hover { box-shadow:0 2px 8px #764ba249;}
        .task-done { text-decoration:line-through; color:#888;}
        .calendar-nav {display:flex;align-items:center;gap:8px;margin-bottom:8px;}
        .calendar-days {display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
        .day-cell {text-align:center;padding:9px 4px;background:#fff;border-radius:7px;border:1px solid #eee;}
        .day-cell.today { background:#667eea;color:#fff;font-weight:bold;}
        .notes-head {display:flex;align-items:center;justify-content:space-between;}
        .note-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;margin-top:18px;}
        .note-card {background:#fff;border-radius:13px;padding:15px;box-shadow:0 3px 15px #667eea12;}
        .note-title {font-weight:bold;margin-bottom:7px;}
    </style>
</head>
<body>
    <div class="sidebar" tabindex="0">
        <div class="logo">Ali Workspace</div>
        <ul class="menu">
            <li class="menu-item active" onclick="showSection('dashboard')"><span>ğŸ“Š</span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
            <li class="menu-item" onclick="showSection('projects')"><span>ğŸ“</span>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</li>
            <li class="menu-item" onclick="showSection('tasks')"><span>âœ…</span>Ø§Ù„Ù…Ù‡Ø§Ù…</li>
            <li class="menu-item" onclick="showSection('calendar')"><span>ğŸ“…</span>Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</li>
            <li class="menu-item" onclick="showSection('notes')"><span>ğŸ“</span>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</li>
        </ul>
    </div>
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="header"><h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</h2></div>
            <div class="stats">
                <div class="stat"><div>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="stat-val" id="statProjects">0</div></div>
                <div class="stat"><div>Ø§Ù„Ù…Ù‡Ø§Ù…</div><div class="stat-val" id="statTasks">0</div></div>
                <div class="stat"><div>Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="stat-val" id="statDone">0</div></div>
            </div>
            <canvas id="chartTasks" height="85"></canvas>
        </div>

        <!-- Projects Section -->
        <div id="projects" class="section">
            <div class="header">
                <h2>ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
                <button class="add-btn" onclick="addProjectPrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
            </div>
            <div class="proj-tabs" id="projTabs"></div>
            <div id="projContent"></div>
        </div>

        <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙƒÙ…Ø§ Ù‡ÙŠ ... -->

        <!-- Tasks Section -->
        <div id="tasks" class="section">
            <div class="header">
                <h2>âœ… Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
                <button class="add-btn" onclick="addTaskPrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
            </div>
            <div class="task-grid">
                <div class="task-head">
                    <select id="tasksProjSelect" onchange="renderTasks()"></select>
                    <span><input type="checkbox" id="showDoneChk" onchange="renderTasks()"> Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                </div>
                <div class="task-list" id="taskList"></div>
            </div>
        </div>
        <!-- Calendar Section -->
        <div id="calendar" class="section">
            <div class="header">
                <h2>ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h2>
            </div>
            <div class="calendar-nav">
                <button onclick="moveMonth(-1)">âŸ¨</button>
                <span id="calendarMonthYear"></span>
                <button onclick="moveMonth(1)">âŸ©</button>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
            <div style="margin-top:16px">
                <ul id="calendarDayTasks"></ul>
            </div>
        </div>
        <!-- Notes Section -->
        <div id="notes" class="section">
            <div class="header notes-head">
                <h2>ğŸ“ Ø¯ÙØªØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
                <button class="add-btn" onclick="addNotePrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</button>
            </div>
            <div class="note-grid" id="noteGrid"></div>
        </div>
    </div>

    <script>
        let projects = JSON.parse(localStorage.getItem("aw_projects")||"[]");
        let tasks = JSON.parse(localStorage.getItem("aw_tasks")||"[]");
        let notes = JSON.parse(localStorage.getItem("aw_notes")||"[]");
        let selectedProj = projects.length ? projects[0].id : null;
        const projStatusText = {active:"Ù†Ø´Ø·",done:"Ù…Ù†ØªÙ‡ÙŠ",paused:"Ù…ØªÙˆÙ‚Ù"};

        function showSection(sec) {
            document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
            document.querySelector('.menu-item[onclick*="' + sec + '"]').classList.add('active');
            document.getElementById(sec).classList.add('active');
            if(sec==="dashboard") renderDashboard();
            if(sec==="projects") { renderProjTabs(); renderProjContent(); }
            if(sec==="tasks") renderTasks();
            if(sec==="calendar") renderCalendar();
            if(sec==="notes") renderNotes();
        }
        // MODAL for Project Add & Edit
        function addProjectPrompt() {
            let bg = document.createElement('div');
            bg.className = 'modal-bg';
            let modal = document.createElement('div');
            modal.className = 'modal-box';
            modal.innerHTML = `
                <div style="font-size:1.18em;font-weight:600;margin-bottom:12px">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</div>
                <input id="pName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" style="width:100%;margin-bottom:11px;padding:6px" /><br>
                <input id="pDesc" type="text" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" style="width:100%;margin-bottom:11px;padding:6px" /><br>
                <label>Ø§Ø®ØªØ± Ù„ÙˆÙ†: <input id="pColor" type="color" value="#667eea" style="margin-right:8px"/></label>
                <br>
                <label>Ø§Ù„Ø­Ø§Ù„Ø©:
                  <select id="pStatus" style="margin-right:7px;">
                    <option value="active">Ù†Ø´Ø·</option>
                    <option value="done">Ù…Ù†ØªÙ‡ÙŠ</option>
                    <option value="paused">Ù…ØªÙˆÙ‚Ù</option>
                  </select>
                </label>
                <br><br>
                <button onclick="saveProject()">Ø­ÙØ¸</button>
                <button onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
            `;
            document.body.appendChild(bg);
            document.body.appendChild(modal);

            window.saveProject = function () {
                let name = document.getElementById("pName").value.trim();
                if (!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹");
                let desc = document.getElementById("pDesc").value.trim();
                let color = document.getElementById("pColor").value;
                let status = document.getElementById("pStatus").value;
                let id = Date.now();
                projects.push({id, name, desc, color, status});
                localStorage.setItem("aw_projects", JSON.stringify(projects));
                selectedProj = id;
                renderProjTabs(); renderProjContent(); renderDashboard();
                closeModal();
                alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹âœ…");
            }
            window.closeModal = function () {
                document.body.removeChild(modal);
                document.body.removeChild(bg);
            }
        }
        function renderProjTabs() {
            let tabs = document.getElementById("projTabs");
            if(!projects.length) { tabs.innerHTML = "<span class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹.</span>"; return; }
            tabs.innerHTML = projects.map(proj =>
                `<div class="proj-tab${selectedProj==proj.id?' selected':''}" onclick="selectProject(${proj.id})">
                    <span class="proj-color-dot" style="background:${proj.color||'#6a59c2'}"></span>
                    ${proj.name}
                    <span class="proj-state ${proj.status}">${projStatusText[proj.status]}</span>
                </div>`
            ).join("");
        }
        function selectProject(id) {
            selectedProj = id;
            renderProjTabs();
            renderProjContent();
        }
        function getProjectIdeas(projId) {
            return JSON.parse(localStorage.getItem('aw_ideas_'+projId)||"[]");
        }
        function setProjectIdeas(projId, ideas) {
            localStorage.setItem('aw_ideas_'+projId, JSON.stringify(ideas));
        }
        function renderProjContent() {
            let container = document.getElementById("projContent");
            let proj = projects.find(p=>p.id==selectedProj);
            if(!proj) { container.innerHTML="<span class='empty-txt'>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙØªØ±.</span>"; return;}
            let ideas = getProjectIdeas(proj.id);
            container.innerHTML = `
                <div class="ideas-section">
                  <div style="font-weight:bold;margin-bottom:8px;font-size:1.08em">Ø¯ÙØªØ± ØªØªØ¨Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ù„Ù…Ø´Ø±ÙˆØ¹ <span style="color:${proj.color};">${proj.name}</span></div>
                  <input id="idea-${proj.id}" type="text" placeholder="Ø£Ø¶Ù ÙÙƒØ±Ø©/Ù…Ù‡Ù…Ø©" style="width:58%;margin-bottom:7px" />
                  <button onclick="addIdea(${proj.id})">Ø¥Ø¶Ø§ÙØ©</button>
                  <table class="ideas-table">
                    <tr>
                      <th>Ø§Ù„ÙÙƒØ±Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th><th>ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ù‡Ù…Ø©</th>
                    </tr>
                    ${ideas.map((i,idx)=>`
                    <tr>
                      <td>${i.text}</td>
                      <td>${i.date}</td>
                      <td>
                        <button onclick="moveIdeaToTask(${proj.id},${idx})">Ø­ÙˆÙ„ Ù„Ù…Ù‡Ù…Ø©</button>
                      </td>
                    </tr>
                    `).join("")}
                  </table>
                  ${ideas.length===0?'<div class="empty-txt">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹!</div>':''}
                </div>
            `;
        }
        function addIdea(projId) {
            let input = document.getElementById(`idea-${projId}`);
            let txt = input.value.trim();
            if(!txt) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
            let ideas = getProjectIdeas(projId);
            ideas.push({text: txt, date: new Date().toISOString().slice(0, 16)});
            setProjectIdeas(projId, ideas);
            input.value = "";
            renderProjContent();
        }
        function moveIdeaToTask(projId, idx) {
            let ideas = getProjectIdeas(projId);
            let idea = ideas[idx];
            let id = Date.now();
            tasks.push({id,projectId:projId,text:idea.text,date:"",done:false});
            localStorage.setItem("aw_tasks", JSON.stringify(tasks));
            ideas.splice(idx,1);
            setProjectIdeas(projId, ideas);
            renderProjContent();
            renderTasks();
            alert("ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙÙƒØ±Ø© Ø¥Ù„Ù‰ Ù…Ù‡Ù…Ø©");
        }
        // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„ÙŠØ²ÙŠÙ„ Ø£ÙÙƒØ§Ø±Ù‡
        function delProject(id) {
            if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆÙƒÙ„ Ù…Ù‡Ø§Ù…Ù‡ ÙˆØ£ÙÙƒØ§Ø±Ù‡ØŸ")) return;
            projects=projects.filter(p=>p.id!=id);
            tasks=tasks.filter(t=>t.projectId!=id);
            localStorage.removeItem('aw_ideas_'+id);
            localStorage.setItem("aw_projects",JSON.stringify(projects));
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            if(selectedProj==id) selectedProj = projects.length ? projects[0].id : null;
            renderProjTabs(); renderProjContent(); renderTasks(); renderDashboard();
        }

        // Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù†ÙØ³Ù‡Ø§ØŒ ÙˆØ¹Ø¯Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯:
        function addTaskPrompt() {
            if(!projects.length) return alert("Ø£Ø¶Ù Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹!");
            let pId=+prompt("Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø£Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©:\n"+projects.map(p=>`${p.id}: ${p.name}`).join("\n"));
            if(!projects.find(p=>p.id==pId)) return alert("Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØºÙŠØ± ØµØ­ÙŠØ­");
            let txt=prompt("ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ"); if(!txt) return;
            let date=prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ØŸ (yyyy-mm-dd) Ø§Ø®ØªÙŠØ§Ø±ÙŠ","");
            let done=false;
            let id=Date.now();
            tasks.push({id,projectId:pId,text:txt,date,done});
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
            alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©âœ…");
        }
        function renderTasks() {
            let select=document.getElementById("tasksProjSelect");
            select.innerHTML=projects.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
            let showDone=document.getElementById("showDoneChk").checked;
            let currentProj=+select.value||(projects[0]?projects[0].id:0);
            let list=document.getElementById("taskList");
            let filtered=tasks.filter(t=>t.projectId==currentProj && (showDone||!t.done));
            if(!filtered.length) { list.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return;}
            list.innerHTML=filtered.map(t=>
                `<div class="task-item ${t.done?'task-done':''}">
                    <span style="flex:1">${t.text}${t.date?' - <span style="font-size:.9em;color:#764ba2">['+t.date+']</span>':''}</span>
                    <button onclick="toggleTask(${t.id})">${t.done?'â':'âœ”ï¸'}</button>
                    <button onclick="delTask(${t.id})" style="color:#d66">Ø­Ø°Ù</button>
                </div>`
            ).join("");
        }
        function delTask(id) {
            if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
            tasks=tasks.filter(t=>t.id!=id);
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
        }
        function toggleTask(id) {
            let t=tasks.find(t=>t.id==id);
            t.done=!t.done;
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
        }
        function renderDashboard() {
            document.getElementById("statProjects").textContent=projects.length;
            document.getElementById("statTasks").textContent=tasks.length;
            document.getElementById("statDone").textContent=tasks.filter(t=>t.done).length;
            let ctx=document.getElementById("chartTasks").getContext('2d');
            if(window.tasksChart) window.tasksChart.destroy();
            window.tasksChart=new Chart(ctx,{
                type:"doughnut",
                data:{
                    labels:["ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©","Ù…ÙƒØªÙ…Ù„Ø©"],
                    datasets:[{
                        data:[tasks.length-tasks.filter(t=>t.done).length,tasks.filter(t=>t.done).length],
                        backgroundColor:["#764ba2","#48bb78"]
                    }]
                },
                options:{responsive:true,plugins:{legend:{position:"bottom"}}}
            });
        }
        let calDate=new Date();
        function moveMonth(val){
            calDate.setMonth(calDate.getMonth()+val);
            renderCalendar();
        }
        function renderCalendar(){
            let d=new Date(calDate);
            d.setDate(1);
            let month=d.getMonth();
            let year=d.getFullYear();
            document.getElementById("calendarMonthYear").textContent = `${year} - ${month+1}`;
            let days=[];
            for(let i=0;i<d.getDay();i++) days.push("");
            let lastDay=new Date(year,month+1,0).getDate();
            for(let i=1;i<=lastDay;i++) days.push(i);
            let today=new Date(); let tDay=today.getDate(),tMonth=today.getMonth(),tYear=today.getFullYear();
            let html="";
            days.forEach(val=>{
                let isToday=val==tDay && month==tMonth && year==tYear;
                let dayTasks=tasks.filter(t=>t.date==`${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}`);
                html+=`<div class="day-cell${isToday?' today':''}" onclick="showTasksForDay('${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}')">${val}${dayTasks.length?' <span style="color:#f56565">â—</span>':''}</div>`
            });
            document.getElementById("calendarDays").innerHTML=html;
            document.getElementById("calendarDayTasks").innerHTML="";
        }
        function showTasksForDay(date){
            let dayTasks=tasks.filter(t=>t.date==date);
            let list=document.getElementById("calendarDayTasks");
            if(!dayTasks.length) {list.innerHTML="<li class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</li>"; return;}
            list.innerHTML=dayTasks.map(t=>`<li>${t.text} (${projects.find(p=>p.id==t.projectId)?.name||""})</li>`).join("");
        }
        function addNotePrompt(){
            let title=prompt("Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"); if(!title) return;
            let text=prompt("Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ");
            let id=Date.now(); notes.push({id,title,text,date:new Date().toISOString().slice(0,16)});
            localStorage.setItem("aw_notes",JSON.stringify(notes));
            renderNotes();
        }
        function renderNotes(){
            let grid=document.getElementById("noteGrid");
            if(!notes.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</p>";return;}
            grid.innerHTML=notes.map(n=>`
                <div class="note-card">
                  <div class="note-title">${n.title}</div>
                  <div style="color:#666">${n.text}</div>
                  <div style="font-size:0.85em;color:#988;margin-top:7px">ØªØ§Ø±ÙŠØ®: ${n.date}</div>
                  <button onclick="delNote(${n.id})" style="color:#c66;margin-top:5px">Ø­Ø°Ù</button>
                </div>
            `).join("");
        }
        function delNote(id){
            if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"))return;
            notes=notes.filter(n=>n.id!=id);
            localStorage.setItem("aw_notes",JSON.stringify(notes));
            renderNotes();
        }
        window.onload = ()=>{
          renderDashboard();
          renderProjTabs();
          renderProjContent();
          renderTasks();
          renderCalendar();
          renderNotes();
        };
    </script>
</body>
</html>
