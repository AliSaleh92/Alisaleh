<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AliW | Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù…ÙŠ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ÙŠ</title>
<link href="https://fonts.googleapis.com/css?family=Tajawal:600,900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root {
  --bg-main:#181922;--bg-side:#232435;--bg-task:#232332;--txt-main:#fff;--txt-sub:#aaa;
  --accent:#43b3fa;--card-space:#202030;--prio-high:#ef4444;--prio-med:#fbbf24;--prio-low:#42a5f5;
}
body{background:var(--bg-main);color:var(--txt-main);font-family:'Tajawal',Arial,sans-serif;margin:0;}
.header-app{display:flex;align-items:center;justify-content:space-between;background:var(--bg-side);padding:20px 22px;font-weight:900;font-size:1.18em;}
.theme-switch{font-size:1.13em;border:none;background:var(--card-space);padding:6px 16px;border-radius:10px;color:var(--accent);cursor:pointer;}
.layout-row{display:flex;}
.sidebar{width:205px;background:var(--bg-side);height:97vh;padding-top:17px;box-shadow:-1px 0 12px #191a2220;display:flex;flex-direction:column;gap:17px;align-items:flex-start;}
.logo{font-weight:900;color:var(--accent);font-size:1.17em;margin-bottom:28px;padding:0 15px;}
.menu-list{margin-bottom:22px;width:100%;}
.menu-btn{padding:12px 15px;font-size:1.08em;color:var(--txt-sub);font-weight:900;border:none;width:100%;background:transparent;text-align:right;cursor:pointer;transition:.13s;font-family:'Tajawal',Arial,sans-serif;}
.menu-btn.active,.menu-btn:hover{color:var(--accent);}
.main-content{flex:1;padding:45px 4vw 45px 7vw;overflow-y:auto;}
.section{display:none;}
.section.active{display:block;}
.section-title{color:var(--accent);font-weight:900;margin:0 0 17px 0;font-size:1.25em;}
.tasks-panel {background: var(--bg-task);border-radius: 17px;box-shadow: 0 2px 12px #1c257922;padding: 0 0 24px 0;max-width: 480px;margin: 38px auto 0 auto;}
.tasks-list {padding: 0 23px;}
.add-task-bar {display: flex;align-items: center;gap: 7px;background: var(--bg-task);padding: 14px 18px 10px 18px;}
.add-task-bar input[type="text"]{flex:1;padding:9px 10px;font-size:1.09em;border-radius:8px;border:1.2px solid #293848;background:var(--bg-side);color:var(--txt-main);}
.add-task-bar button{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:8px 12px;cursor:pointer;font-size:.98em;}
.add-task-bar .opt-btn{background:transparent;color:var(--accent);border:none;font-size:1.25em;cursor:pointer;}
.adv-row{display:none;gap:6px;padding-top:9px;margin-bottom:6px;padding:0 23px;}
.adv-row select,.adv-row input{border-radius:7px;padding:5px 7px;font-size:.98em;border:1px solid #355;flex:1;background:var(--bg-side);color:var(--txt-main);}
.task-row {display: flex;align-items: flex-start;gap: 13px;padding: 17px 0 14px 0;border-bottom: 1px solid #444b;}
.task-row:last-child {border-bottom:none;}
.task-check {width: 25px; height: 25px; background: #232435;border-radius: 50%; border: 1.3px solid #2787ef33;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.1s;}
.task-check.checked{background:var(--accent);border-color:var(--accent);}
.task-check .material-icons {font-size:1.19em;}
.task-title {font-size:1.12em;font-weight:900;margin-bottom:5px;word-break:break-word;}
.task-title.done{ text-decoration: line-through; color: #788b95; }
.task-meta {color: var(--txt-sub); font-size: .98em; display: flex;gap: 7px; align-items: center; margin-bottom: 3px;}
.task-actions button {background: #272a3a; color: var(--accent); border: none;padding: 2.5px 11px 2.5px 12px; border-radius: 8px; cursor: pointer;font-size: .96em; margin-left: 5px; font-family: 'Tajawal', Arial, sans-serif}
.task-actions button.del {color: var(--prio-high);}
.task-actions button:active{background:var(--accent);color:#fff;}
.archive-btn{background:var(--accent);color:#fff;border:none;padding:8px 15px;border-radius:8px;cursor:pointer;margin-top:15px;font-family:'Tajawal',Arial,sans-serif;}
.projects-board{max-width:900px;margin:22px auto 0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:24px;align-items:start;}
.project-card{background:var(--bg-task);border-radius:16px;box-shadow:0 2px 18px 1px #173a7335;padding:18px 15px 14px 19px;display:flex;flex-direction:column;align-items:flex-start;gap:9px;cursor:pointer;transition:.14s;}
.project-card.active{box-shadow:0 0px 0px 3px var(--accent);}
.project-head{font-size:1.07em;font-weight:900;margin-bottom:4px;}
.project-label{display:inline-block;padding:2.2px 13px 4px 12px;border-radius:13px;font-size:1.07em;color:#fff;}
.project-desc{color:var(--txt-sub);padding-bottom:3px;}
.project-actions button{background:#232739;color:#52c2fc;border:none;padding:3px 15px 4px 15px;border-radius:7px;cursor:pointer;font-size:.97em;margin-left:3px;}
.project-actions button.del{color:#ef4444;}
.add-proj-board{max-width:420px;margin:auto;padding:14px 13px 13px 13px;background:var(--bg-task);border-radius:14px;box-shadow:0 2px 8px #173a7320;display:flex;flex-direction:column;gap:7px;}
.add-proj-form label{font-weight:bold;}
.add-proj-form input,.add-proj-form textarea,.add-proj-form select{border-radius:7px;border:1.1px solid #305;padding:8px;font-size:1em;margin-bottom:7px;background:var(--bg-side);color:var(--txt-main);}
.add-proj-form{display:flex;flex-direction:column;gap:7px;}
.add-proj-form button{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:9px 0;font-size:1.12em;cursor:pointer;width:fit-content;min-width:140px;font-family:'Tajawal',Arial,sans-serif;}
#customModal {display:none;position:fixed;top:0;right:0;left:0;bottom:0;z-index:1200;background:rgba(25,27,40,.56);align-items:center;justify-content:center;}
#customModal .modal-box {background:var(--bg-task);padding:33px 25px 25px 25px;border-radius:15px;min-width:350px;max-width:97vw;box-shadow:0 8px 38px #11226c99;display:flex;flex-direction:column;gap:13px;}
#customModal input[type="text"],#customModal input[type="time"],#customModal input[type="date"] {width:100%;padding:10px 9px;border-radius:8px;border:1.2px solid #48508a;font-size:1.07em;background:#22283a;color:#fff;}
#customModal label{font-weight:bold;margin-top:5px;}
#customModal button {font-family:'Tajawal',Arial,sans-serif;border:none;background:var(--accent);margin:0 0 0 7px;color:#fff;border-radius:8px;padding:6px 18px;font-size:1em;cursor:pointer;}
#customModal button.cancelBtn{background:#353b55;color:#fff;}
#customModal .modalBtnArea{display:flex;justify-content:flex-end;gap:9px;margin-top:10px;}
.calendar-container{max-width:980px;margin:0 auto;background:var(--bg-task);border-radius:12px;padding:20px;box-shadow:0 2px 12px #1c257922;}
.calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.calendar-header h2{color:var(--accent);font-size:1.3em;margin:0;}
.calendar-nav{display:flex;gap:10px;}
.calendar-nav button{background:var(--bg-side);color:var(--txt-main);border:none;padding:8px 15px;border-radius:8px;cursor:pointer;font-family:'Tajawal',Arial,sans-serif;}
.calendar-nav button:hover{background:var(--accent);}
.calendar-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:10px;text-align:center;font-weight:900;color:var(--accent);}
.calendar-weekdays div{padding:10px 0;}
.calendar-days{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;}
.calendar-day{background:var(--bg-side);min-height:100px;padding:8px;border-radius:8px;cursor:pointer;transition:.2s;position:relative;}
.calendar-day:hover{background:#2a2d45;}
.calendar-day.today{border:2px solid var(--accent);}
.calendar-day.other-month{opacity:0.3;}
.calendar-day-num{font-weight:900;font-size:1.1em;margin-bottom:5px;}
.calendar-event{background:var(--accent);color:#fff;padding:3px 6px;border-radius:5px;font-size:0.85em;margin-bottom:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.calendar-event:hover{opacity:0.8;}
.add-event-btn{background:var(--accent);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:1em;font-family:'Tajawal',Arial,sans-serif;margin-bottom:15px;}
</style>
</head>
<body data-theme="dark">

<div id="customModal">
  <div class="modal-box">
    <span id="modalTitle" style="font-weight:900;font-size:1.15em;color:var(--accent);"></span>
    <div id="modalContent"></div>
    <div class="modalBtnArea">
      <button class="cancelBtn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button id="modalOkBtn">Ù…ÙˆØ§ÙÙ‚</button>
    </div>
  </div>
</div>

<div class="header-app">
  <span>AliW | Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù…ÙŠ ÙˆÙ…Ø´Ø§Ø±ÙŠØ¹ÙŠ</span>
  <button class="theme-switch" onclick="toggleTheme()" id="themeToggle">ğŸŒ™</button>
</div>

<div class="layout-row">
  <div class="sidebar">
    <div class="logo">AliW</div>
    <div class="menu-list">
      <button class="menu-btn active" id="tasksMenuBtn" onclick="setSection('tasks')">Ø§Ù„Ù…Ù‡Ø§Ù…</button>
      <button class="menu-btn" id="projectsMenuBtn" onclick="setSection('projects')">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</button>
      <button class="menu-btn" id="calendarMenuBtn" onclick="setSection('calendar')">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</button>
    </div>
  </div>
  
  <div class="main-content">
    <div class="section active" id="tasksSection">
      <div class="section-title">Ù…Ù‡Ø§Ù…ÙŠ</div>
      <div class="tasks-panel">
        <div class="add-task-bar">
          <input type="text" id="taskInput" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." maxlength="80">
          <button onclick="addTaskSimple()">Ø¥Ø¶Ø§ÙØ©</button>
          <button class="opt-btn" onclick="toggleAdvRow()"><span class="material-icons">expand_more</span></button>
        </div>
        <div class="adv-row" id="advRow">
          <input type="date" id="taskDue">
        </div>
        <div class="tasks-list" id="tasksList"></div>
      </div>
      <button class="archive-btn" onclick="showArchive()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</button>
      <div class="archive-section" id="archiveSection" style="display:none">
        <div style="color:var(--accent);font-weight:900;margin:15px 0 10px 0;">Ø§Ù„Ø£Ø±Ø´ÙŠÙ</div>
        <div class="archive-list" id="archiveList"></div>
        <button class="archive-btn" onclick="closeArchive()" style="background:var(--txt-sub);margin-top:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>

    <div class="section" id="projectsSection">
      <div class="section-title">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
      <div class="add-proj-board">
        <form class="add-proj-form" onsubmit="addProjectCard();return false;">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
          <input type="text" id="projName" maxlength="28" required>
          <label>ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
          <textarea id="projDesc" maxlength="100" rows="2" required></textarea>
          <label>Ù„ÙˆÙ† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
          <select id="projColor">
            <option value="#43b3fa">Ø£Ø²Ø±Ù‚</option>
            <option value="#ef4444">Ø£Ø­Ù…Ø±</option>
            <option value="#fb8c00">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
            <option value="#01bc82">Ø£Ø®Ø¶Ø±</option>
            <option value="#f74d89">ÙˆØ±Ø¯ÙŠ</option>
          </select>
          <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
        </form>
      </div>
      <div class="projects-board" id="projectsBoard"></div>
    </div>

    <div class="section" id="calendarSection">
      <div class="section-title">Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>
      <button class="add-event-btn" onclick="showAddEventModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</button>
      <div class="calendar-container">
        <div class="calendar-header">
          <h2 id="currentMonthYear"></h2>
          <div class="calendar-nav">
            <button onclick="changeMonth(-1)">â—„ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button onclick="changeMonth(0)">Ø§Ù„ÙŠÙˆÙ…</button>
            <button onclick="changeMonth(1)">Ø§Ù„ØªØ§Ù„ÙŠ â–º</button>
          </div>
        </div>
        <div class="calendar-weekdays">
          <div>Ø§Ù„Ø£Ø­Ø¯</div>
          <div>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div>
          <div>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div>
          <div>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
          <div>Ø§Ù„Ø®Ù…ÙŠØ³</div>
          <div>Ø§Ù„Ø¬Ù…Ø¹Ø©</div>
          <div>Ø§Ù„Ø³Ø¨Øª</div>
        </div>
        <div class="calendar-days" id="calendarDays"></div>
      </div>
    </div>
  </div>
</div>

<script>
let modalCallback = null;
let tasks = JSON.parse(localStorage.getItem("projTasks_tasks")||'[]');
let projectsExtra = JSON.parse(localStorage.getItem("projTasks_extracard")||'[]');
let calendarEvents = JSON.parse(localStorage.getItem("calendar_events")||'[]');
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

function showModal(title, content, okCallback) {
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalContent").innerHTML = content;
  document.getElementById("customModal").style.display = "flex";
  modalCallback = okCallback;
}
function closeModal(){
  document.getElementById("customModal").style.display = "none";
  modalCallback=null;
}
document.getElementById("modalOkBtn").onclick = function() {
  if(modalCallback) modalCallback();
  closeModal();
};
document.getElementById("customModal").onclick = function(e){
  if(e.target==this) closeModal();
}

function renderProjectsCards(){
  const board=document.getElementById("projectsBoard");
  if(!projectsExtra.length){
    board.innerHTML="<div style='color:var(--txt-sub);padding:35px 0;text-align:center'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯.</div>";
    return;
  }
  board.innerHTML=projectsExtra.map((p,i)=>
    `<div class="project-card">
      <div class="project-head"><span class="project-label" style="background:${p.color};">${p.title}</span></div>
      <div class="project-desc">${p.desc}</div>
      <div class="project-actions">
        <button onclick="editProjectCard(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="delProjectCard(${i})" class="del">Ø­Ø°Ù</button>
      </div>
    </div>`
  ).join("");
}

function addProjectCard(){
  let name=document.getElementById("projName").value.trim();
  let desc=document.getElementById("projDesc").value.trim();
  let color=document.getElementById("projColor").value;
  if(!name||!desc)return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ + ÙˆØµÙÙ‡");
  projectsExtra.push({id:Date.now(),title:name,desc,color});
  localStorage.setItem("projTasks_extracard",JSON.stringify(projectsExtra));
  document.getElementById("projName").value="";
  document.getElementById("projDesc").value="";
  renderProjectsCards();
}
function delProjectCard(i){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ"))return;
  projectsExtra.splice(i,1);
  localStorage.setItem("projTasks_extracard",JSON.stringify(projectsExtra));
  renderProjectsCards();
}
function editProjectCard(i){
  let proj=projectsExtra[i];
  showModal("ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:", `<input type="text" id="editProjName" value="${proj.title}" style="width:100%;padding:10px;border-radius:8px;border:1px solid #48508a;background:#22283a;color:#fff;">`, ()=>{
    let newTitle = document.getElementById("editProjName").value.trim();
    if(newTitle){
      projectsExtra[i].title=newTitle;
      localStorage.setItem("projTasks_extracard",JSON.stringify(projectsExtra));
      renderProjectsCards();
    }
  });
}

function renderTaskList(){
  document.getElementById("archiveSection").style.display="none";
  let list=document.getElementById("tasksList");
  let all=tasks.filter(t=>!t.done);
  if(!all.length) {list.innerHTML ='<div style="color:var(--txt-sub);padding:33px 0;text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>'; return;}
  list.innerHTML=all.map((t,i)=>{
    let idx=tasks.indexOf(t);
    return `<div class="task-row">
      <div class="task-check${t.done?' checked':''}" onclick="toggleDone(${idx})"><span class="material-icons">${t.done?'check':'radio_button_unchecked'}</span></div>
      <div style="flex:1;">
        <div class="task-title${t.done?' done':''}">${t.title}</div>
        <div class="task-meta">${t.due?`<span><span class="material-icons" style="font-size:1em;vertical-align:middle">event</span> ${t.due}</span>`:""}</div>
        <div class="task-actions">
          <button onclick="editTask(${idx})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button onclick="delTask(${idx})" class="del">Ø­Ø°Ù</button>
        </div>
      </div>
    </div>`
  }).join('');
}
function addTaskSimple(){
  let title=document.getElementById("taskInput").value.trim();
  let due=document.getElementById("taskDue")?.value||"";
  if(!title)return;
  tasks.push({id:Date.now(),title,done:false,due});
  localStorage.setItem("projTasks_tasks",JSON.stringify(tasks));
  document.getElementById("taskInput").value="";
  if(document.getElementById("taskDue")) document.getElementById("taskDue").value="";
  renderTaskList();
}
function editTask(i){
  let t=tasks[i];
  showModal("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©:",`<input type="text" id="editTaskTitle" value="${t.title}" style="width:100%;padding:10px;border-radius:8px;border:1px solid #48508a;background:#22283a;color:#fff;">`,()=>{
    let newTitle=document.getElementById("editTaskTitle").value.trim();
    if(newTitle){
      t.title=newTitle;
      localStorage.setItem("projTasks_tasks",JSON.stringify(tasks));
      renderTaskList();
    }
  });
}
function delTask(i){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ"))return;
  tasks.splice(i,1);
  localStorage.setItem("projTasks_tasks",JSON.stringify(tasks));
  renderTaskList();
}
function toggleDone(i){
  tasks[i].done=!tasks[i].done;
  localStorage.setItem("projTasks_tasks",JSON.stringify(tasks));
  renderTaskList();
}
function showArchive(){
  let arch=tasks.filter(t=>t.done);
  let arcCont=document.getElementById("archiveList");
  document.getElementById("archiveSection").style.display="block";
  if(!arch.length){arcCont.innerHTML='<div style="color:var(--txt-sub);padding:14px 0;text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ù†Ø¬Ø²Ø©</div>';return;}
  arcCont.innerHTML=arch.map((t)=>{
    let idx=tasks.indexOf(t);
    return `<div class="task-row"><div style="flex:1;"><div class="task-title done">${t.title}</div><div class="task-actions"><button onclick="unarchiveTask(${idx})" style="background:var(--accent);color:#fff;">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</button><button onclick="delTask(${idx})" class="del">Ø­Ø°Ù</button></div></div></div>`
  }).join('');
}
function closeArchive(){
  document.getElementById("archiveSection").style.display="none";
}
function unarchiveTask(i){
  tasks[i].done=false;
  localStorage.setItem("projTasks_tasks",JSON.stringify(tasks));
  showArchive();
}
function toggleAdvRow(){
  let adv=document.getElementById("advRow");
  adv.style.display=(adv.style.display=="flex"?"none":"flex");
}

function setSection(sec) {
  document.getElementById('tasksSection').classList.remove('active');
  document.getElementById('projectsSection').classList.remove('active');
  document.getElementById('calendarSection').classList.remove('active');
  document.getElementById('tasksMenuBtn').classList.remove('active');
  document.getElementById('projectsMenuBtn').classList.remove('active');
  document.getElementById('calendarMenuBtn').classList.remove('active');

  if (sec == "tasks") {
    document.getElementById('tasksSection').classList.add('active');
    document.getElementById('tasksMenuBtn').classList.add('active');
    renderTaskList();
  } else if (sec == "projects") {
    document.getElementById('projectsSection').classList.add('active');
    document.getElementById('projectsMenuBtn').classList.add('active');
    renderProjectsCards();
  } else if (sec == "calendar") {
    document.getElementById('calendarSection').classList.add('active');
    document.getElementById('calendarMenuBtn').classList.add('active');
    renderCalendar();
  }
}

function toggleTheme(){
  let th=document.body.dataset.theme=="dark"?"light":"dark";
  document.body.dataset.theme=th;
  document.getElementById("themeToggle").textContent=th=="dark"?"â˜€ï¸":"ğŸŒ™";
  localStorage.setItem("theme_mode",th);
}

function renderCalendar(){
  const monthNames = ["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
  document.getElementById("currentMonthYear").textContent = `${monthNames[currentMonth]} ${currentYear}`;
  
  let firstDay = new Date(currentYear, currentMonth, 1).getDay();
  let daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();
  let prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
  
  let days = "";
  let today = new Date();
  let todayStr = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
  
  for(let i=firstDay-1; i>=0; i--){
    days += `<div class="calendar-day other-month"><div class="calendar-day-num">${prevMonthDays-i}</div></div>`;
  }
  
  for(let day=1; day<=daysInMonth; day++){
    let dateStr = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    let dayEvents = calendarEvents.filter(e=>e.date===dateStr);
    let isToday = dateStr===todayStr ? ' today' : '';
    days += `<div class="calendar-day${isToday}" onclick="showDayEvents('${dateStr}')">
      <div class="calendar-day-num">${day}</div>
      ${dayEvents.map(e=>`<div class="calendar-event">${e.title} ${e.time?e.time:''}</div>`).join('')}
    </div>`;
  }
  
  let remainingDays = 42 - (firstDay + daysInMonth);
  for(let i=1; i<=remainingDays; i++){
    days += `<div class="calendar-day other-month"><div class="calendar-day-num">${i}</div></div>`;
  }
  
  document.getElementById("calendarDays").innerHTML = days;
}

function changeMonth(dir){
  if(dir===0){
    currentMonth = new Date().getMonth();
    currentYear = new Date().getFullYear();
  } else {
    currentMonth += dir;
    if(currentMonth > 11){currentMonth=0; currentYear++;}
    if(currentMonth < 0){currentMonth=11; currentYear--;}
  }
  renderCalendar();
}

function showAddEventModal(){
  showModal("Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯",`
    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯:</label>
    <input type="text" id="eventTitle" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚">
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="eventDate">
    <label>Ø§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="time" id="eventTime">
  `,()=>{
    let title = document.getElementById("eventTitle").value.trim();
    let date = document.getElementById("eventDate").value;
    let time = document.getElementById("eventTime").value;
    if(!title || !date) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®");
    calendarEvents.push({id:Date.now(),title,date,time});
    localStorage.setItem("calendar_events",JSON.stringify(calendarEvents));
    renderCalendar();
  });
}

function showDayEvents(dateStr){
  let dayEvents = calendarEvents.filter(e=>e.date===dateStr);
  if(!dayEvents.length){
    showAddEventModal();
    return;
  }
  let content = `<div style="text-align:right;">Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙŠÙˆÙ… ${dateStr}:</div>`;
  content += dayEvents.map((e,i)=>`
    <div style="background:var(--bg-side);padding:10px;margin:5px 0;border-radius:8px;">
      <strong>${e.title}</strong> ${e.time?`- ${e.time}`:''}
      <button onclick="deleteEvent(${calendarEvents.indexOf(e)})" style="background:#ef4444;color:#fff;border:none;padding:3px 10px;border-radius:5px;cursor:pointer;float:left;">Ø­Ø°Ù</button>
    </div>
  `).join('');
  showModal(`Ù…ÙˆØ§Ø¹ÙŠØ¯ ${dateStr}`, content, ()=>{renderCalendar();});
}

function deleteEvent(i){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ"))return;
  calendarEvents.splice(i,1);
  localStorage.setItem("calendar_events",JSON.stringify(calendarEvents));
  closeModal();
  renderCalendar();
}

document.body.dataset.theme = localStorage.getItem("theme_mode")||"dark";
document.getElementById("themeToggle").textContent = document.body.dataset.theme=="dark"?"â˜€ï¸":"ğŸŒ™";
renderProjectsCards();
renderTaskList();
renderCalendar();
</script>
</body>
</html>
