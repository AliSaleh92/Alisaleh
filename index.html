<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali Workspace - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css?family=Tajawal:400,500,700,900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Tajawal', Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
            background: #fafbfd;
        }
        .sidebar, .bottom-nav {
            position: fixed; right: 0; top: 0; width: 70px; height: 100vh;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color: #fff; padding: 25px 6px 18px 6px; box-shadow: -2px 0 15px #667eea21;
            z-index: 300; display: flex; flex-direction: column; gap: 28px; align-items: center; transition: width 0.18s;
        }
        .logo { text-align: center; margin-bottom: 32px; font-size: 1.28em; font-weight: 900; letter-spacing:1px;}
        .menu { list-style: none; padding: 0; width: 100%; margin:0;}
        .menu-item { padding: 17px 9px 17px 10px; border-radius: 11px; margin-bottom: 9px; cursor: pointer; font-size: 1.19em;  transition: background 0.15s,color .15s;}
        .menu-item.active, .menu-item:hover { background:rgba(255,255,255,.21); color: #fff; }
        .menu-item span { margin-right: 7px;}
        .main-content { margin-right: 70px; padding: 32px 10px 72px 10px; min-height: 100vh; transition: margin-right .18s;}
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px;}
        .header h2 {margin: 0; font-size:2.09em;color:#667eea;font-weight:800;}
        .section {display:none;}
        .section.active {display:block; animation:fadeIn .41s;}
        @keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
        .add-btn { padding:9px 21px; font-size:1.07em; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border:none; border-radius:21px; cursor:pointer; margin-bottom:16px; font-weight:700; box-shadow:0 3px 14px #764ba248;}
        .stats {display: flex; gap: 20px; flex-wrap: wrap; margin-bottom:32px;}
        .stat { background:#fff; border-radius:18px; padding:22px; box-shadow:0 6px 28px #667eea13; width:168px; text-align:center;}
        .stat-val { font-size:2em; margin:8px 0 0 0; color:#764ba2;}
        .proj-tabs {display: flex; gap: 14px; overflow-x: auto; margin-bottom: 25px;}
        .proj-tab {padding:13px 37px; background:linear-gradient(135deg,#fff 30%,#eef1fb 100%);
            border-radius:21px 21px 0 0; cursor:pointer; font-weight:800; font-size:1.08em;
            box-shadow:0 9px 22px #671be94c; transition:background .2s, box-shadow .2s, color .15s;
            border: 2.2px solid transparent; border-bottom: none;
            color:#554; position:relative; text-align:center}
        .proj-tab.selected {
            background: #fff; color:#764ba2; border-color: #a892ef #a892ef #fff #a892ef;
            box-shadow:0 19px 38px #9980fa2a, 0 1px 0 #fff;
        }
        .proj-state { display:inline-block; padding:3px 13px; border-radius:9px; font-size:.98em; margin-left:11px;margin-right:7px;font-weight:700;}
        .proj-state.active { background:#48bb78; color:#fff;}
        .proj-state.done { background:#ccd; color:#444;}
        .proj-state.paused { background:#faed5c; color:#555;}
        .proj-color-dot { width:21px;height:21px;border-radius:50%;display:inline-block;margin-right:8px;vertical-align:middle;box-shadow:0 0 0 2px #eee;}
        .proj-edit-btn { padding:0 11px; background:#fdedfa; color:#764ba2; font-weight:700; border-radius:8px; border:none; margin-right:6px;cursor:pointer;font-size:0.97em;}
        /* Ø¯ÙØ§ØªØ± ÙˆØ£ÙÙƒØ§Ø± */
        .ideas-section {background:#fcfdff;padding:17px 15px 24px 17px;margin-top:17px;border-radius:21px; box-shadow:0 8px 32px #667eea2f;}
        .ideas-table {width:100%;margin-top:11px;background:#f7f9fd;border-radius:18px;border-collapse:collapse; font-size:1.12em;}
        .ideas-table th, .ideas-table td{padding:11px 7px;border-bottom:1px solid #e5e5e5;text-align:center;}
        .ideas-table th {background: #764ba2; color:#fff; font-weight:700;}
        .ideas-table td { vertical-align:middle; }
        .empty-txt {text-align:center;color:#bbb;font-size:1.07em;padding:7px;}
        .idea-state {display:inline-block;padding:4px 15px;border-radius:10px;font-weight:600;font-size:.97em;}
        .idea-status.todo { background:#fec; color:#924;}
        .idea-status.inprogress { background:#d7f5bf;color:#1b7b23;}
        .idea-status.done { background:#c9eaff;color:#33b3af;}
        /* Modal styles */
        .modal-bg { position:fixed;top:0;right:0;left:0;bottom:0; background:rgba(137,112,226,.12);z-index:900;}
        .modal-box {position:fixed;top:50%;right:50%;transform:translate(50%,-50%);
            background:#fff;padding:34px 24px;border-radius:22px;box-shadow:0 14px 38px #0002;z-index:999;width:367px;max-width:97vw;}
        .modal-box input, .modal-box select {font-size:1em;padding:7px;border-radius:9px;border:1.2px solid #ece1fa;margin-bottom:13px;width:98%;}
        .modal-btn-bar{display:flex;justify-content:space-between;gap:10px;margin-top:20px;}
        @media (max-width: 840px){
            .main-content {margin-right:0;padding:17px 5px 78px 5px;}
            .sidebar { top:auto; bottom: 0; right:0; left:0; width:100vw; height:70px; flex-direction:row; gap:9px; padding:11px 0; background:linear-gradient(90deg,#667eea,#764ba2);}
            .logo {display:none;}
            .menu {display:flex;flex-direction:row;gap:18px;width:auto;}
            .menu-item {padding:11px 8px 11px 6px;margin:0;border-radius:15px; font-size:1.06em;}
            .menu-item span {margin:0;}
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">Ali Workspace</div>
        <ul class="menu">
            <li class="menu-item active" onclick="showSection('dashboard')"><span>ğŸ“Š</span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
            <li class="menu-item" onclick="showSection('projects')"><span>ğŸ“</span>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</li>
            <li class="menu-item" onclick="showSection('tasks')"><span>âœ…</span>Ø§Ù„Ù…Ù‡Ø§Ù…</li>
            <li class="menu-item" onclick="showSection('calendar')"><span>ğŸ“…</span>Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</li>
            <li class="menu-item" onclick="showSection('notes')"><span>ğŸ“</span>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</li>
        </ul>
    </div>
    <div class="main-content">
        <div id="dashboard" class="section active">
            <div class="header"><h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</h2></div>
            <div class="stats">
                <div class="stat"><div>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="stat-val" id="statProjects">0</div></div>
                <div class="stat"><div>Ø§Ù„Ù…Ù‡Ø§Ù…</div><div class="stat-val" id="statTasks">0</div></div>
                <div class="stat"><div>Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div><div class="stat-val" id="statDone">0</div></div>
            </div>
            <canvas id="chartTasks" height="86"></canvas>
        </div>
        <div id="projects" class="section">
            <div class="header">
                <h2>ğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
                <button class="add-btn" onclick="addProjectPrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
            </div>
            <div class="proj-tabs" id="projTabs"></div>
            <div id="projContent"></div>
        </div>
        <div id="tasks" class="section">
            <div class="header">
                <h2>âœ… Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
                <button class="add-btn" onclick="addTaskPrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
            </div>
            <div class="task-grid">
                <div class="task-head">
                    <select id="tasksProjSelect" onchange="renderTasks()"></select>
                    <span><input type="checkbox" id="showDoneChk" onchange="renderTasks()"> Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</span>
                </div>
                <div class="task-list" id="taskList"></div>
            </div>
        </div>
        <div id="calendar" class="section">
            <div class="header">
                <h2>ğŸ“… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h2>
            </div>
            <div class="calendar-nav">
                <button onclick="moveMonth(-1)">âŸ¨</button>
                <span id="calendarMonthYear"></span>
                <button onclick="moveMonth(1)">âŸ©</button>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
            <div style="margin-top:16px">
                <ul id="calendarDayTasks"></ul>
            </div>
        </div>
        <div id="notes" class="section">
            <div class="header notes-head">
                <h2>ğŸ“ Ø¯ÙØªØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
                <button class="add-btn" onclick="addNotePrompt()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</button>
            </div>
            <div class="note-grid" id="noteGrid"></div>
        </div>
    </div>
    <script>
        let projects = JSON.parse(localStorage.getItem("aw_projects")||"[]");
        let tasks = JSON.parse(localStorage.getItem("aw_tasks")||"[]");
        let notes = JSON.parse(localStorage.getItem("aw_notes")||"[]");
        let selectedProj = projects.length ? projects[0].id : null;
        const projStatusText = {active:"Ù†Ø´Ø·",done:"Ù…Ù†ØªÙ‡ÙŠ",paused:"Ù…ØªÙˆÙ‚Ù"};
        const taskStatusText = {todo:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",inprogress:"Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„",done:"Ù…Ù†Ø¬Ø²Ø©"};
        // Ø¨Ø¯ÙØªØ± Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        function showSection(sec) {
            document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
            document.querySelector('.menu-item[onclick*="' + sec + '"]').classList.add('active');
            document.getElementById(sec).classList.add('active');
            if(sec==="dashboard") renderDashboard();
            if(sec==="projects") { renderProjTabs(); renderProjContent(); }
            if(sec==="tasks") renderTasks();
            if(sec==="calendar") renderCalendar();
            if(sec==="notes") renderNotes();
        }
        function renderProjTabs() {
            let tabs = document.getElementById("projTabs");
            if(!projects.length) { tabs.innerHTML = "<span class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹.</span>"; return; }
            tabs.innerHTML = projects.map(proj =>
                `<div class="proj-tab${selectedProj==proj.id?' selected':''}" onclick="selectProject(${proj.id})">
                    <span class="proj-color-dot" style="background:${proj.color||'#6a59c2'}"></span>
                    ${proj.name}
                    <span class="proj-state ${proj.status}">${projStatusText[proj.status]}</span>
                    <button class="proj-edit-btn" onclick="event.stopPropagation();editProjectPrompt(${proj.id})">ØªØ­Ø±ÙŠØ±</button>
                </div>`
            ).join("");
        }
        function selectProject(id) {
            selectedProj = id;
            renderProjTabs();
            renderProjContent();
        }
        function getProjectIdeas(projId) {
            return JSON.parse(localStorage.getItem('aw_ideas_'+projId)||"[]");
        }
        function setProjectIdeas(projId, ideas) {
            localStorage.setItem('aw_ideas_'+projId, JSON.stringify(ideas));
        }
        function renderProjContent() {
            let container = document.getElementById("projContent");
            let proj = projects.find(p=>p.id==selectedProj);
            if(!proj) { container.innerHTML="<span class='empty-txt'>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙØªØ±.</span>"; return;}
            let ideas = getProjectIdeas(proj.id);
            container.innerHTML = `
                <div class="ideas-section">
                  <div style="font-weight:800;margin-bottom:8px;font-size:1.18em">Ø¯ÙØªØ± ØªØªØ¨Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ù„Ù…Ø´Ø±ÙˆØ¹ <span style="color:${proj.color};">${proj.name}</span></div>
                  <input id="idea-${proj.id}" type="text" placeholder="Ø£Ø¶Ù ÙÙƒØ±Ø© Ø£Ùˆ Ù…Ù‡Ù…Ø© Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø©" style="width:59%;margin-bottom:9px" />
                  <select id="ideastat-${proj.id}" style="padding:4px 9px">
                    <option value="todo">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                    <option value="inprogress">Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„</option>
                    <option value="done">Ù…Ù†Ø¬Ø²Ø©</option>
                  </select>
                  <button onclick="addIdea(${proj.id})">Ø¥Ø¶Ø§ÙØ©</button>
                  <table class="ideas-table">
                    <tr>
                      <th>Ø§Ù„ÙÙƒØ±Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                    </tr>
                    ${ideas.map((i)=>
                    `<tr>
                      <td>${i.text}</td>
                      <td><span class="idea-state idea-status ${i.status||'todo'}">${taskStatusText[i.status||'todo']}</span></td>
                      <td>${i.date||''}</td>
                    </tr>`
                    ).join("")}
                  </table>
                  ${ideas.length===0?'<div class="empty-txt">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹!</div>':''}
                </div>
            `;
        }
        function addIdea(projId) {
            let input = document.getElementById(`idea-${projId}`);
            let stat = document.getElementById(`ideastat-${projId}`).value;
            let txt = input.value.trim();
            if(!txt) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
            let ideas = getProjectIdeas(projId);
            ideas.push({text: txt, status: stat, date: new Date().toISOString().slice(0, 16)});
            setProjectIdeas(projId, ideas);
            input.value = ""; document.getElementById(`ideastat-${projId}`).value="todo";
            renderProjContent();
        }

        // ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        function editProjectPrompt(id) {
            let proj = projects.find(p=>p.id==id);
            let bg = document.createElement('div');
            bg.className = 'modal-bg';
            let modal = document.createElement('div');
            modal.className = 'modal-box';
            modal.innerHTML = `
                <div style="font-size:1.22em;font-weight:800;margin-bottom:12px">ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>
                <input id="pNameEdit" type="text" value="${proj.name}" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" /><br>
                <input id="pDescEdit" type="text" value="${proj.desc||""}" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" /><br>
                <label> Ø§Ù„Ù„ÙˆÙ†: <input id="pColorEdit" type="color" value="${proj.color||"#667eea"}" style="margin-right:8px"/></label>
                <br>
                <label> Ø§Ù„Ø­Ø§Ù„Ø©:
                  <select id="pStatusEdit">
                    <option value="active"${proj.status=="active"?' selected':''}>Ù†Ø´Ø·</option>
                    <option value="done"${proj.status=="done"?' selected':''}>Ù…Ù†ØªÙ‡ÙŠ</option>
                    <option value="paused"${proj.status=="paused"?' selected':''}>Ù…ØªÙˆÙ‚Ù</option>
                  </select>
                </label>
                <div class="modal-btn-bar">
                  <button onclick="saveEditedProject(${proj.id})" class="add-btn">Ø­ÙØ¸</button>
                  <button onclick="closeModal()" style="background:#eee;color:#764ba2;border-radius:10px;">Ø¥Ù„ØºØ§Ø¡</button>
                  <button onclick="delProject(${proj.id})" style="background:#fdeded;color:#d66;border-radius:10px;">Ø­Ø°Ù</button>
                </div>
            `;
            document.body.appendChild(bg);
            document.body.appendChild(modal);

            window.saveEditedProject = function(pid) {
                let name = document.getElementById("pNameEdit").value.trim();
                if (!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹");
                let desc = document.getElementById("pDescEdit").value.trim();
                let color = document.getElementById("pColorEdit").value;
                let status = document.getElementById("pStatusEdit").value;
                let projIdx = projects.findIndex(p=>p.id==pid);
                projects[projIdx] = {...projects[projIdx], name, desc, color, status};
                localStorage.setItem("aw_projects", JSON.stringify(projects));
                renderProjTabs(); renderProjContent(); renderDashboard();
                closeModal();
                alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª");
            }
            window.closeModal = function () {
                document.body.removeChild(modal);
                document.body.removeChild(bg);
            }
        }

        // Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        function delProject(id) {
            if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆÙƒÙ„ Ù…Ù‡Ø§Ù…Ù‡ ÙˆØ£ÙÙƒØ§Ø±Ù‡ØŸ")) return;
            projects=projects.filter(p=>p.id!=id);
            tasks=tasks.filter(t=>t.projectId!=id);
            localStorage.removeItem('aw_ideas_'+id);
            localStorage.setItem("aw_projects",JSON.stringify(projects));
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            if(selectedProj==id) selectedProj = projects.length ? projects[0].id : null;
            renderProjTabs(); renderProjContent(); renderTasks(); renderDashboard();
        }
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ...
        function addTaskPrompt() {
            if(!projects.length) return alert("Ø£Ø¶Ù Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹!");
            let pId=+prompt("Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø£Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©:\n"+projects.map(p=>`${p.id}: ${p.name}`).join("\n"));
            if(!projects.find(p=>p.id==pId)) return alert("Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØºÙŠØ± ØµØ­ÙŠØ­");
            let txt=prompt("ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ"); if(!txt) return;
            let date=prompt("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ØŸ (yyyy-mm-dd) Ø§Ø®ØªÙŠØ§Ø±ÙŠ","");
            let done=false;
            let id=Date.now();
            tasks.push({id,projectId:pId,text:txt,date,done});
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
            alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©âœ…");
        }
        function renderTasks() {
            let select=document.getElementById("tasksProjSelect");
            select.innerHTML=projects.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
            let showDone=document.getElementById("showDoneChk").checked;
            let currentProj=+select.value||(projects[0]?projects[0].id:0);
            let list=document.getElementById("taskList");
            let filtered=tasks.filter(t=>t.projectId==currentProj && (showDone||!t.done));
            if(!filtered.length) { list.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>"; return;}
            list.innerHTML=filtered.map(t=>
                `<div class="task-item ${t.done?'task-done':''}">
                    <span style="flex:1">${t.text}${t.date?' - <span style="font-size:.99em;color:#764ba2">['+t.date+']</span>':''}</span>
                    <button onclick="toggleTask(${t.id})">${t.done?'â':'âœ”ï¸'}</button>
                    <button onclick="delTask(${t.id})" style="color:#d66">Ø­Ø°Ù</button>
                </div>`
            ).join("");
        }
        function delTask(id) {
            if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
            tasks=tasks.filter(t=>t.id!=id);
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
        }
        function toggleTask(id) {
            let t=tasks.find(t=>t.id==id);
            t.done=!t.done;
            localStorage.setItem("aw_tasks",JSON.stringify(tasks));
            renderTasks(); renderDashboard();
        }
        function renderDashboard() {
            document.getElementById("statProjects").textContent=projects.length;
            document.getElementById("statTasks").textContent=tasks.length;
            document.getElementById("statDone").textContent=tasks.filter(t=>t.done).length;
            let ctx=document.getElementById("chartTasks").getContext('2d');
            if(window.tasksChart) window.tasksChart.destroy();
            window.tasksChart=new Chart(ctx,{
                type:"doughnut",
                data:{
                    labels:["ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©","Ù…ÙƒØªÙ…Ù„Ø©"],
                    datasets:[{
                        data:[tasks.length-tasks.filter(t=>t.done).length,tasks.filter(t=>t.done).length],
                        backgroundColor:["#764ba2","#48bb78"]
                    }]
                },
                options:{responsive:true,plugins:{legend:{position:"bottom"}}}
            });
        }
        let calDate=new Date();
        function moveMonth(val){
            calDate.setMonth(calDate.getMonth()+val);
            renderCalendar();
        }
        function renderCalendar(){
            let d=new Date(calDate);
            d.setDate(1);
            let month=d.getMonth();
            let year=d.getFullYear();
            document.getElementById("calendarMonthYear").textContent = `${year} - ${month+1}`;
            let days=[];
            for(let i=0;i<d.getDay();i++) days.push("");
            let lastDay=new Date(year,month+1,0).getDate();
            for(let i=1;i<=lastDay;i++) days.push(i);
            let today=new Date(); let tDay=today.getDate(),tMonth=today.getMonth(),tYear=today.getFullYear();
            let html="";
            days.forEach(val=>{
                let isToday=val==tDay && month==tMonth && year==tYear;
                let dayTasks=tasks.filter(t=>t.date==`${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}`);
                html+=`<div class="day-cell${isToday?' today':''}" onclick="showTasksForDay('${year}-${String(month+1).padStart(2,'0')}-${String(val).padStart(2,'0')}')">${val}${dayTasks.length?' <span style="color:#f56565">â—</span>':''}</div>`
            });
            document.getElementById("calendarDays").innerHTML=html;
            document.getElementById("calendarDayTasks").innerHTML="";
        }
        function showTasksForDay(date){
            let dayTasks=tasks.filter(t=>t.date==date);
            let list=document.getElementById("calendarDayTasks");
            if(!dayTasks.length) {list.innerHTML="<li class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</li>"; return;}
            list.innerHTML=dayTasks.map(t=>`<li>${t.text} (${projects.find(p=>p.id==t.projectId)?.name||""})</li>`).join("");
        }
        function addNotePrompt(){
            let title=prompt("Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"); if(!title) return;
            let text=prompt("Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ");
            let id=Date.now(); notes.push({id,title,text,date:new Date().toISOString().slice(0,16)});
            localStorage.setItem("aw_notes",JSON.stringify(notes));
            renderNotes();
        }
        function renderNotes(){
            let grid=document.getElementById("noteGrid");
            if(!notes.length){grid.innerHTML="<p class='empty-txt'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</p>";return;}
            grid.innerHTML=notes.map(n=>`
                <div class="note-card">
                  <div class="note-title">${n.title}</div>
                  <div style="color:#666">${n.text}</div>
                  <div style="font-size:0.85em;color:#988;margin-top:7px">ØªØ§Ø±ÙŠØ®: ${n.date}</div>
                  <button onclick="delNote(${n.id})" style="color:#c66;margin-top:5px">Ø­Ø°Ù</button>
                </div>
            `).join("");
        }
        function delNote(id){
            if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"))return;
            notes=notes.filter(n=>n.id!=id);
            localStorage.setItem("aw_notes",JSON.stringify(notes));
            renderNotes();
        }
        window.onload = ()=>{
          renderDashboard();
          renderProjTabs();
          renderProjContent();
          renderTasks();
          renderCalendar();
          renderNotes();
        };
    </script>
</body>
</html>
